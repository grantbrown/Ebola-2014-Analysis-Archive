
<!DOCTYPE html>
<html lang="en">
  <head>
<style type="text/css">
.knitr.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
},
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0em 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage.left {
  text-align: left;
}
.rimage.right {
  text-align: right;
}
.rimage.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>2014 Ebola Epidemic</title>
    <link href="./bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="./css/ebola.css" rel="stylesheet">
    
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://grantbrown.github.io/libspatialSEIR/">libspatialSEIR</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="#toc-section-anchor">TOC</a></li>
            <li><a href="http://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology">Compartmental Models</a></li>
            <li><a href="http://en.wikipedia.org/wiki/2014_Guinea_Ebola_outbreak">More on the Outbreak</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
  
  
    <div id = "title-section" class = "container">
      <div class="row">
        <div class="col-sm-12">
          <h1>Estimating and Predicting Epidemic Behavior for the 2014 West African Ebola Outbreak</h1>
          <h4>A Quick Stochastic Spatial SEIR Modeling Approach</h4>
          <h5><a href="https://grantbrown.github.io">Grant Brown</a></h5>
          <h5><a href="http://www.public-health.uiowa.edu/people/jacob-oleson/">Jacob Oleson</a></h5>
          <h5>Last Updated:
2014-12-10
</h5>
        </div>
      </div>
    </div>
    <a id="toc-section-anchor" class="anchor"></a>
    <div id="toc-section" class="container">
      <h2>Table of Contents</h2>
      <div class = "row">
        <div class="col-sm-11 col-sm-offset-1">
          <ol>
            <li><a href="#introduction-sect">Introduction</a>
              <ul>
                <li><a href="#intro-abstract-sect">About This Document</li>
                <li><a href="#intro-outbreak-sect">The Outbreak</li>
                <li><a href="#intro-data-sect">The Data</li>
                <li><a href="#intro-compartment-sect">Compartmental Models</li>
              </ul>
            </li>
            <li><a href="#anchor-analysis-2-sect">Analysis</a>
              <ul>
                <li><a href="#analysis-2-set-up-sect">Set Up</a></li>
                <li><a href="#analysis-2-convergence-sect">Convergence Diagnosis</a></li>
                <li><a href="#analysis-2-r0-sect">Basic Reproductive Number</a></li>
                <li><a href="#analysis-2-prediction-sect">Prediction</a></li>
              </ul>
            </li>
            <li><a href="#conclusions-sect">Conclusions</a></li>
          </ol>
        </div>
      </div>
    </div>

    <div class="container">
      <a id="introduction-sect" class="anchor">
      <h2>Introduction</h2>
      </a>
      <div class="row">
        <div class = "col-sm-10 col-sm-offset-1">
          <a id="intro-abstract-sect" class="anchor">
          <h3>About this document.</h3>
          </a>
          <p>This is a living document, as the Ebola epidemic is rapidly evolving. Presented below is a preliminary modeling approach to the 
          crisis, originally conceived as an illustration of the spatial SEIR model family generally and the capabilities of the rapidly developing 
          (and totally unfinished) libspatialSEIR software library particularly. This is not yet peer reviewed research, or even a particularly complete analysis. 
          Nevertheless, we hope that the initial exploration given below is instructive and useful. </p>
          <br/>
          <p>
          Past versions of this analysis are cached in a repository on Github, and remain available: 
          <ul>
            <li><a href="http://grantbrown.github.io/Ebola-2014-Analysis-Archive/Sep_08_2014/Ebola2014/Ebola2014.html">Sep  8, 2014</a></li>
            <li><a href="http://grantbrown.github.io/Ebola-2014-Analysis-Archive/Aug_28_2014/Ebola2014/Ebola2014.html">Aug 28, 2014</a></li>
            <li><a href="http://grantbrown.github.io/Ebola-2014-Analysis-Archive/Aug_12_2014/Ebola2014/Ebola2014.html">Aug 12, 2014</a></li>
            <li><a href="http://grantbrown.github.io/Ebola-2014-Analysis-Archive/Aug_10_2014/Ebola2014/Ebola2014.html">Aug 10, 2014</a></li>
            <li><a href="http://grantbrown.github.io/Ebola-2014-Analysis-Archive/Aug_05_2014/Ebola2014/Ebola2014.html">Aug 5, 2014</a></li>
            <li><a href="http://grantbrown.github.io/Ebola-2014-Analysis-Archive/Aug_03_2014/Ebola2014/Ebola2014.html">Aug 3, 2014</a></li>
            <li><a href="http://grantbrown.github.io/Ebola-2014-Analysis-Archive/Jul_30_2014/Ebola2014/Ebola2014.html">Jul 30, 2014</a></li>
            <li><a href="http://grantbrown.github.io/Ebola-2014-Analysis-Archive/Jul_29_2014/Ebola2014/Ebola2014.html">Jul 29, 2014</a></li>
            <li><a href="http://grantbrown.github.io/Ebola-2014-Analysis-Archive/Jul_25_2014/Ebola2014/Ebola2014.html">Jul 25, 2014</a></li>
            <li><a href="http://grantbrown.github.io/Ebola-2014-Analysis-Archive/Jul_24_2014/Ebola2014/Ebola2014.html">Jul 25, 2014</a></li>
          <ul>
          
          <p>Additional analyses are underway. An <a href = "http://grantbrown.github.io/libspatialSEIR/doc/tutorials/Ebola2014/Ebola2014_PastPred.html">informal look at prediction performance over time</a> is also available.</p>
        </div>
        <div class="col-sm-1"></div>
        <br/>
        <div class = "col-sm-10 col-sm-offset-1">
          <a id="intro-abstract-sect" class="anchor">
          <h3>Summary of Recent Changes</h3>
          </a>
          <ul>
            <li><strong>Oct 2</strong> There have been a lot of changes for this release. The temporal component was dramatically simplified, so we're fitting a baseline SEIR model with a different intensity parameter for each nation. In addition, the spatial structure was generalized to allow a separate mixing parameter for each pair of countries. Finally, three different methods of calculating R0 are compared, and a lot of behind the scenes changes to libspatialSEIR and the R API took place. Upcoming changes include the introduction of "hybrid" samplers which may help deal with some of the autocorrelation, seen for example in the E to I transition probability chains. Despite the model changes, we continue to see a dramatic and prolonged predicted increase in cases.  </li>
            <li><strong>Sep 8</strong> Fixed R0 calculations, which were showing the per-report R0 components, but didn't account for infection length. They have now been appropriately integrated over time.</li>
            <li><strong>Sep 4</strong> The situation continues to worsen, which is especially worrying given that the data used are almost certainly undercounts. Removed the polynomial analysis in favor of the spline basis analysis to save on computation time. </li>
            <li><strong>Aug 31</strong> Basic reproductive number clearly very heterogenous between countries. Other interpretations TBD.</li>
            <li><strong>Aug 28</strong> With the addition of Nigeria and new data, the situation appears dire across the board, especially in Liberia. The basic reproductive number calculations no longer look reasonable, so more must be done to estimate them separately for each country. The changes may also be due to recent changes to the R0 estimation code, which must now be reevaluated. This work is underway. </li>
            <li><strong>Aug 12</strong> Liberia continues to worsen, though Sierra Leone appears to have leveled off. Guinea might be worsening slightly. </li>
            <li><strong>Aug 10</strong> Predictions remain much the same, though perhaps not so immediately catestrophic as the August 5 predictions. </li>
            <li><Strong>Aug 5</strong> Models begin to show catastrophic predictions. Epidemic is changing too quickly for these simple models.</li>
            <ul>
              <li>Shorten prediction window</li>
              <li>Increase intensity process flexibility (quartic rather than cubic)</li>
              <li>Recall that these models can't account for changing inteventions, of which there are many. The predictions are therefore made
              under the assumption that the epidemic will continue to evolve according to the same process it has so far.</li>
            </ul>
            <li><Strong>Aug 3</strong> Predicted epidmic curves start to strongly favor a uniformly worsening situation.</li>
            <li><Strong>July 30</strong> Previous predictions of mid-fall resolution of epidemic begin to shift.</li>
          </ul>
        </div>
        <div class="col-sm-1"></div>
        
        
        <div class = "col-sm-10 col-sm-offset-1">
        <a id="intro-outbreak-sect" class="anchor">
        <h3>The Outbreak</h3>
        </a>
          <p>
          The 2014 Ebola outbreak in West Africa is an ongoing public health crisis, which has killed thousands of people so far. The cross-border nature of this epidemic, which emerged in Guinea, Liberia and Sierra Leone has complicated mitigation efforts, as has the poor health infrastructure in the region. This document explores a simple spatial SEIR model to make some initial predictions. 
          </p>
          <a id="intro-data-sect" class="anchor">
        <h3>The Data</h3>
        </a>
        <p>
        A summary of the WHO case reports is very helpfully compiled on wikipedia. It can be easily read into R with the xml library: 
      </p>
<button class="btn btn-default code-button">Show/Hide Code Block</button>
<div class="code-and-output-block" style="display:none">
<div class="chunk" id="LoadPackagesReadData"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(knitr)</span>
<span class="hl kwd">library</span><span class="hl std">(coda)</span> <span class="hl com"># Load the coda library for MCMC convergence diagnosis</span>
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: lattice
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(spatialSEIR)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: Rcpp
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(XML)</span> <span class="hl com"># Load the XML library to read in data from Wikipedia</span>
<span class="hl kwd">library</span><span class="hl std">(parallel)</span> <span class="hl com"># Load the parallel library to enable multiple chains to be run simultaneously. </span>

<span class="hl com">## Define Document Compilation Parameters</span>

<span class="hl std">documentCompilationMode</span> <span class="hl kwb">=</span> <span class="hl str">&quot;release&quot;</span>
<span class="hl com">#documentCompilationMode = &quot;debug&quot;</span>
<span class="hl com"># How many degrees of freedom should the fit have?</span>
<span class="hl std">modelDF</span> <span class="hl kwb">=</span> <span class="hl num">5</span>
<span class="hl com"># if modelDF != 0, should spline basis be knot based or DF based?</span>
<span class="hl com"># Option1: &quot;Knots&quot;</span>
<span class="hl com"># Option2: &quot;DF&quot;</span>
<span class="hl std">modelMode</span> <span class="hl kwb">=</span> <span class="hl str">&quot;DF&quot;</span>
<span class="hl com"># How far into the future do we want to make predictions?</span>
<span class="hl std">pred.days</span> <span class="hl kwb">=</span> <span class="hl num">120</span>


<span class="hl com">## Compute number of samples/batches</span>
<span class="hl std">numBurnInBatches</span> <span class="hl kwb">=</span>      <span class="hl kwd">ifelse</span><span class="hl std">(documentCompilationMode</span> <span class="hl opt">==</span> <span class="hl str">&quot;release&quot;</span><span class="hl std">,</span> <span class="hl num">1000</span><span class="hl std">,</span>  <span class="hl num">100</span><span class="hl std">)</span>
<span class="hl std">convergenceCriterion</span> <span class="hl kwb">=</span>  <span class="hl kwd">ifelse</span><span class="hl std">(documentCompilationMode</span> <span class="hl opt">==</span> <span class="hl str">&quot;release&quot;</span><span class="hl std">,</span> <span class="hl num">1.2</span><span class="hl std">,</span>  <span class="hl num">100</span><span class="hl std">)</span>
<span class="hl std">convergenceSampleSize</span> <span class="hl kwb">=</span>  <span class="hl kwd">ifelse</span><span class="hl std">(documentCompilationMode</span> <span class="hl opt">==</span> <span class="hl str">&quot;release&quot;</span><span class="hl std">,</span> <span class="hl num">100000</span><span class="hl std">,</span> <span class="hl num">100</span><span class="hl std">)</span>
<span class="hl std">convergenceBatchSize</span> <span class="hl kwb">=</span>  <span class="hl kwd">ifelse</span><span class="hl std">(documentCompilationMode</span> <span class="hl opt">==</span> <span class="hl str">&quot;release&quot;</span><span class="hl std">,</span> <span class="hl num">100000</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">)</span>
<span class="hl std">minimumSamples</span> <span class="hl kwb">=</span>         <span class="hl kwd">ifelse</span><span class="hl std">(documentCompilationMode</span> <span class="hl opt">==</span> <span class="hl str">&quot;release&quot;</span><span class="hl std">,</span> <span class="hl num">3000000</span><span class="hl std">,</span> <span class="hl num">200000</span><span class="hl std">)</span>
<span class="hl std">extraR0Iterations</span> <span class="hl kwb">=</span>     <span class="hl kwd">ifelse</span><span class="hl std">(documentCompilationMode</span> <span class="hl opt">==</span> <span class="hl str">&quot;release&quot;</span><span class="hl std">,</span> <span class="hl num">500</span><span class="hl std">,</span>   <span class="hl num">10</span><span class="hl std">)</span>
<span class="hl std">extraR0BatchSize</span> <span class="hl kwb">=</span>     <span class="hl kwd">ifelse</span><span class="hl std">(documentCompilationMode</span> <span class="hl opt">==</span> <span class="hl str">&quot;release&quot;</span><span class="hl std">,</span> <span class="hl num">1000</span><span class="hl std">,</span>   <span class="hl num">10</span><span class="hl std">)</span>
<span class="hl std">iterationStride</span> <span class="hl kwb">=</span>       <span class="hl kwd">ifelse</span><span class="hl std">(documentCompilationMode</span> <span class="hl opt">==</span> <span class="hl str">&quot;release&quot;</span><span class="hl std">,</span> <span class="hl num">1000</span><span class="hl std">,</span>   <span class="hl num">100</span><span class="hl std">)</span>
<span class="hl std">targetDaysPerRecord</span> <span class="hl kwb">=</span> <span class="hl num">3</span>
<span class="hl std">totalSamples</span> <span class="hl kwb">=</span> <span class="hl num">0</span>

<span class="hl com">## Read in the data</span>

<span class="hl std">dat</span> <span class="hl kwb">=</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;../../Data/ebola/country_timeseries.csv&quot;</span><span class="hl std">)[,</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">3</span><span class="hl std">,</span><span class="hl num">4</span><span class="hl std">,</span><span class="hl num">5</span><span class="hl std">)]</span>

<span class="hl std">charDate</span> <span class="hl kwb">=</span> <span class="hl kwd">as.character</span><span class="hl std">(dat[</span><span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(dat),</span><span class="hl num">1</span><span class="hl std">])</span>

<span class="hl std">rptDate</span> <span class="hl kwb">=</span> <span class="hl kwd">as.Date</span><span class="hl std">(charDate,</span> <span class="hl str">&quot;%m/%d/%Y&quot;</span><span class="hl std">)</span>
<span class="hl std">numDays</span> <span class="hl kwb">=</span> <span class="hl kwd">max</span><span class="hl std">(rptDate)</span> <span class="hl opt">-</span> <span class="hl kwd">min</span><span class="hl std">(rptDate)</span> <span class="hl opt">+</span> <span class="hl num">1</span>
<span class="hl std">numDays.pred</span> <span class="hl kwb">=</span> <span class="hl std">numDays</span> <span class="hl opt">+</span> <span class="hl std">pred.days</span>

<span class="hl std">original.rptDate</span> <span class="hl kwb">=</span> <span class="hl std">rptDate</span>
<span class="hl std">ascendingOrder</span> <span class="hl kwb">=</span> <span class="hl kwd">order</span><span class="hl std">(rptDate)</span>
<span class="hl std">rptDate</span> <span class="hl kwb">=</span> <span class="hl std">rptDate[ascendingOrder][</span><span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(rptDate)]</span>
<span class="hl std">original.rptDate</span> <span class="hl kwb">=</span> <span class="hl std">original.rptDate[ascendingOrder]</span>


<span class="hl std">cleanData</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">dataColumn</span><span class="hl std">,</span> <span class="hl kwc">ascendingOrder</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl com"># Remove commas</span>
    <span class="hl std">charCol</span> <span class="hl kwb">=</span> <span class="hl kwd">as.character</span><span class="hl std">(dataColumn)[ascendingOrder]</span>

    <span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(charCol[</span><span class="hl num">1</span><span class="hl std">]))</span>
    <span class="hl std">{</span>
      <span class="hl std">charCol[</span><span class="hl num">1</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;0&quot;</span>
    <span class="hl std">}</span>
    <span class="hl std">charCol</span> <span class="hl kwb">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(charCol)</span>

    <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(charCol))</span>
    <span class="hl std">{</span>
      <span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(charCol[i]))</span>
      <span class="hl std">{</span>
        <span class="hl std">charCol[i]</span> <span class="hl kwb">=</span> <span class="hl std">charCol[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">]</span>
      <span class="hl std">}</span>
    <span class="hl std">}</span>
    <span class="hl com"># charCol</span>
    <span class="hl com"># Correct for undercounts</span>
    <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(charCol),</span> <span class="hl num">2</span><span class="hl std">))</span>
    <span class="hl std">{</span>
        <span class="hl kwa">if</span> <span class="hl std">(charCol[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">]</span> <span class="hl opt">&gt;</span> <span class="hl std">charCol[i])</span>
        <span class="hl std">{</span>
            <span class="hl std">charCol[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl std">charCol[i]</span>
        <span class="hl std">}</span>
    <span class="hl std">}</span>
    <span class="hl std">charCol</span>
<span class="hl std">}</span>

<span class="hl std">Guinea</span> <span class="hl kwb">=</span> <span class="hl kwd">cleanData</span><span class="hl std">(dat[,</span><span class="hl num">2</span><span class="hl std">], ascendingOrder)</span>
<span class="hl std">Liberia</span> <span class="hl kwb">=</span> <span class="hl kwd">cleanData</span><span class="hl std">(dat[,</span><span class="hl num">3</span><span class="hl std">], ascendingOrder)</span>
<span class="hl std">Sierra.Leone</span> <span class="hl kwb">=</span> <span class="hl kwd">cleanData</span><span class="hl std">(dat[,</span><span class="hl num">4</span><span class="hl std">], ascendingOrder)</span>
<span class="hl std">rawData</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(Guinea, Sierra.Leone, Liberia)</span>
<span class="hl kwd">rownames</span><span class="hl std">(rawData)</span> <span class="hl kwb">=</span> <span class="hl kwd">as.character</span><span class="hl std">(original.rptDate)</span>
<span class="hl kwd">colnames</span><span class="hl std">(rawData)</span> <span class="hl kwb">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;&amp;nbsp;&amp;nbsp;&quot;</span><span class="hl std">,</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Guinea&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Liberia&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Sierra Leone&quot;</span><span class="hl std">)),</span> <span class="hl str">&quot;&amp;nbsp;&amp;nbsp;&quot;</span><span class="hl std">)</span>

<span class="hl com"># The data needs to be aggregated: there's some error in the measurements, </span>
<span class="hl com"># and we're not actually observing infection times. The data is therefore</span>
<span class="hl com"># recorded at an artifically high time scale.</span>
<span class="hl std">uncumulate</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl std">out</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(x[</span><span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(x)]</span><span class="hl opt">-</span><span class="hl std">x[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(x)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)])</span>
    <span class="hl kwd">ifelse</span><span class="hl std">(out</span> <span class="hl opt">&gt;=</span> <span class="hl num">0</span><span class="hl std">, out,</span> <span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">}</span>
<span class="hl std">nDays</span> <span class="hl kwb">=</span> <span class="hl kwd">uncumulate</span><span class="hl std">(original.rptDate)</span>

<span class="hl std">thinIndices</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">minDays</span><span class="hl std">,</span> <span class="hl kwc">weights</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl std">keepIdx</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(weights))</span>
    <span class="hl std">currentWeight</span> <span class="hl kwb">=</span> <span class="hl num">0</span>
    <span class="hl std">lastIdx</span> <span class="hl kwb">=</span> <span class="hl opt">-</span><span class="hl num">1</span>
    <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(weights)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">))</span>
    <span class="hl std">{</span>
      <span class="hl std">currentWeight</span> <span class="hl kwb">=</span> <span class="hl std">currentWeight</span> <span class="hl opt">+</span> <span class="hl std">weights[i]</span>
      <span class="hl kwa">if</span> <span class="hl std">(currentWeight</span> <span class="hl opt">&gt;=</span> <span class="hl std">minDays)</span>
      <span class="hl std">{</span>
          <span class="hl std">currentWeight</span> <span class="hl kwb">=</span> <span class="hl num">0</span>
          <span class="hl std">keepIdx</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(keepIdx, i)</span>
          <span class="hl std">lastIdx</span> <span class="hl kwb">=</span> <span class="hl std">i</span>
      <span class="hl std">}</span>
    <span class="hl std">}</span>
    <span class="hl kwa">if</span> <span class="hl std">(currentWeight</span> <span class="hl opt">!=</span> <span class="hl num">0</span><span class="hl std">)</span>
    <span class="hl std">{</span>
      <span class="hl std">keepIdx</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(keepIdx, lastIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)</span>
    <span class="hl std">}</span>
    <span class="hl std">keepIdx</span>
<span class="hl std">}</span>

<span class="hl std">keepIdx</span> <span class="hl kwb">=</span> <span class="hl kwd">thinIndices</span><span class="hl std">(targetDaysPerRecord,</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,nDays))</span>
<span class="hl std">keepIdx</span> <span class="hl kwb">=</span> <span class="hl std">keepIdx[</span><span class="hl kwd">order</span><span class="hl std">(keepIdx)]</span>



<span class="hl com"># Define the plot for the next section</span>
<span class="hl std">ylim</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">min</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(Guinea, Sierra.Leone, Liberia)),</span>
             <span class="hl kwd">max</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(Guinea, Sierra.Leone, Liberia)))</span>
<span class="hl std">figure1</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
      <span class="hl kwd">plot</span><span class="hl std">(original.rptDate, Guinea,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span>
           <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Raw Data: Case Counts From Wikipedia&quot;</span><span class="hl std">,</span>
           <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span>
           <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Total Cases&quot;</span><span class="hl std">,</span>
           <span class="hl kwc">ylim</span> <span class="hl std">= ylim,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">)</span>
      <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">100000</span><span class="hl std">,</span> <span class="hl num">100</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
      <span class="hl kwd">lines</span><span class="hl std">(original.rptDate, Liberia,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
      <span class="hl kwd">lines</span><span class="hl std">(original.rptDate, Sierra.Leone,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">)</span>

      <span class="hl kwd">legend</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= original.rptDate[</span><span class="hl num">1</span><span class="hl std">],</span> <span class="hl kwc">y</span> <span class="hl std">=</span> <span class="hl kwd">max</span><span class="hl std">(ylim),</span> <span class="hl kwc">legend</span> <span class="hl std">=</span>
               <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Guinea&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Liberia&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Sierra Leone&quot;</span><span class="hl std">),</span>
             <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span><span class="hl str">&quot;red&quot;</span><span class="hl std">),</span> <span class="hl kwc">bg</span><span class="hl std">=</span><span class="hl str">&quot;white&quot;</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">1.1</span><span class="hl std">,</span>
             <span class="hl kwc">lwd</span><span class="hl std">=</span><span class="hl num">3</span><span class="hl std">)</span>
<span class="hl std">}</span>


<span class="hl std">Guinea</span> <span class="hl kwb">=</span> <span class="hl std">Guinea[keepIdx]</span>
<span class="hl std">Sierra.Leone</span> <span class="hl kwb">=</span> <span class="hl std">Sierra.Leone[keepIdx]</span>
<span class="hl std">Liberia</span> <span class="hl kwb">=</span> <span class="hl std">Liberia[keepIdx]</span>

<span class="hl std">original.rptDate</span> <span class="hl kwb">=</span> <span class="hl std">original.rptDate[keepIdx]</span>
<span class="hl std">rptDate</span> <span class="hl kwb">=</span> <span class="hl std">original.rptDate[</span><span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(original.rptDate)]</span>
</pre></div>
</div></div>
</div>
<p>
With data in hand, let's begin where every analysis should begin: graphs.
</p>

<div class="chunk" id="PlotFig1"><div class="rimage center"><img src="figure/PlotFig1.png" title="plot of chunk PlotFig1" alt="plot of chunk PlotFig1" class="plot" /></div></div>
<p>
  In addition to the above graph, the raw data is archived for posterity in the code block below. Wikipedia changes a lot, so it's important 
  to record the context of the results presented here. 
</p>
<button class="btn btn-default code-button">Show/Hide Code Block</button>
<div class="code-and-output-block" style="display:none">
<div class="source"><pre class="knitr r"><span class="hl kwd">kable</span><span class="hl std">(rawData)</span>
</pre></div>
<table>
 <thead>
  <tr>
   <th align="left">   </th>
   <th align="right"> &nbsp;&nbsp; Guinea &nbsp;&nbsp; </th>
   <th align="right"> &nbsp;&nbsp; Liberia &nbsp;&nbsp; </th>
   <th align="right"> &nbsp;&nbsp; Sierra Leone &nbsp;&nbsp; </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td align="left"> 2014-03-22 </td>
   <td align="right"> 86 </td>
   <td align="right"> 0 </td>
   <td align="right"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-03-24 </td>
   <td align="right"> 86 </td>
   <td align="right"> 0 </td>
   <td align="right"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-03-25 </td>
   <td align="right"> 86 </td>
   <td align="right"> 0 </td>
   <td align="right"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-03-26 </td>
   <td align="right"> 103 </td>
   <td align="right"> 0 </td>
   <td align="right"> 3 </td>
  </tr>
  <tr>
   <td align="left"> 2014-03-27 </td>
   <td align="right"> 112 </td>
   <td align="right"> 0 </td>
   <td align="right"> 3 </td>
  </tr>
  <tr>
   <td align="left"> 2014-03-28 </td>
   <td align="right"> 112 </td>
   <td align="right"> 0 </td>
   <td align="right"> 7 </td>
  </tr>
  <tr>
   <td align="left"> 2014-03-29 </td>
   <td align="right"> 122 </td>
   <td align="right"> 0 </td>
   <td align="right"> 8 </td>
  </tr>
  <tr>
   <td align="left"> 2014-03-31 </td>
   <td align="right"> 127 </td>
   <td align="right"> 0 </td>
   <td align="right"> 8 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-01 </td>
   <td align="right"> 143 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-04 </td>
   <td align="right"> 151 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-07 </td>
   <td align="right"> 158 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-09 </td>
   <td align="right"> 159 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-11 </td>
   <td align="right"> 168 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-14 </td>
   <td align="right"> 168 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-15 </td>
   <td align="right"> 197 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-16 </td>
   <td align="right"> 203 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-17 </td>
   <td align="right"> 208 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-20 </td>
   <td align="right"> 208 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-21 </td>
   <td align="right"> 208 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-22 </td>
   <td align="right"> 218 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-23 </td>
   <td align="right"> 218 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-24 </td>
   <td align="right"> 224 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-26 </td>
   <td align="right"> 226 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-01 </td>
   <td align="right"> 231 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-03 </td>
   <td align="right"> 233 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-05 </td>
   <td align="right"> 233 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-07 </td>
   <td align="right"> 233 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-10 </td>
   <td align="right"> 248 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-12 </td>
   <td align="right"> 258 </td>
   <td align="right"> 0 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-23 </td>
   <td align="right"> 281 </td>
   <td align="right"> 16 </td>
   <td align="right"> 12 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-27 </td>
   <td align="right"> 291 </td>
   <td align="right"> 50 </td>
   <td align="right"> 13 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-28 </td>
   <td align="right"> 328 </td>
   <td align="right"> 79 </td>
   <td align="right"> 13 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-01 </td>
   <td align="right"> 344 </td>
   <td align="right"> 79 </td>
   <td align="right"> 13 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-03 </td>
   <td align="right"> 344 </td>
   <td align="right"> 81 </td>
   <td align="right"> 13 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-05 </td>
   <td align="right"> 351 </td>
   <td align="right"> 89 </td>
   <td align="right"> 13 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-10 </td>
   <td align="right"> 390 </td>
   <td align="right"> 89 </td>
   <td align="right"> 33 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-16 </td>
   <td align="right"> 390 </td>
   <td align="right"> 97 </td>
   <td align="right"> 33 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-17 </td>
   <td align="right"> 390 </td>
   <td align="right"> 136 </td>
   <td align="right"> 33 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-18 </td>
   <td align="right"> 390 </td>
   <td align="right"> 136 </td>
   <td align="right"> 41 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-19 </td>
   <td align="right"> 390 </td>
   <td align="right"> 158 </td>
   <td align="right"> 41 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-20 </td>
   <td align="right"> 390 </td>
   <td align="right"> 158 </td>
   <td align="right"> 51 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-22 </td>
   <td align="right"> 406 </td>
   <td align="right"> 239 </td>
   <td align="right"> 107 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-30 </td>
   <td align="right"> 406 </td>
   <td align="right"> 252 </td>
   <td align="right"> 115 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-02 </td>
   <td align="right"> 406 </td>
   <td align="right"> 305 </td>
   <td align="right"> 131 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-06 </td>
   <td align="right"> 406 </td>
   <td align="right"> 337 </td>
   <td align="right"> 142 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-08 </td>
   <td align="right"> 406 </td>
   <td align="right"> 386 </td>
   <td align="right"> 172 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-12 </td>
   <td align="right"> 410 </td>
   <td align="right"> 397 </td>
   <td align="right"> 174 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-14 </td>
   <td align="right"> 410 </td>
   <td align="right"> 442 </td>
   <td align="right"> 196 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-17 </td>
   <td align="right"> 415 </td>
   <td align="right"> 454 </td>
   <td align="right"> 224 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-20 </td>
   <td align="right"> 427 </td>
   <td align="right"> 525 </td>
   <td align="right"> 249 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-23 </td>
   <td align="right"> 460 </td>
   <td align="right"> 533 </td>
   <td align="right"> 329 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-27 </td>
   <td align="right"> 472 </td>
   <td align="right"> 574 </td>
   <td align="right"> 391 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-30 </td>
   <td align="right"> 485 </td>
   <td align="right"> 646 </td>
   <td align="right"> 468 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-01 </td>
   <td align="right"> 495 </td>
   <td align="right"> 691 </td>
   <td align="right"> 516 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-04 </td>
   <td align="right"> 495 </td>
   <td align="right"> 717 </td>
   <td align="right"> 554 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-06 </td>
   <td align="right"> 506 </td>
   <td align="right"> 730 </td>
   <td align="right"> 599 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-09 </td>
   <td align="right"> 510 </td>
   <td align="right"> 783 </td>
   <td align="right"> 670 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-11 </td>
   <td align="right"> 519 </td>
   <td align="right"> 810 </td>
   <td align="right"> 786 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-13 </td>
   <td align="right"> 543 </td>
   <td align="right"> 848 </td>
   <td align="right"> 834 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-16 </td>
   <td align="right"> 579 </td>
   <td align="right"> 907 </td>
   <td align="right"> 972 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-18 </td>
   <td align="right"> 607 </td>
   <td align="right"> 910 </td>
   <td align="right"> 1082 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-20 </td>
   <td align="right"> 648 </td>
   <td align="right"> 1026 </td>
   <td align="right"> 1378 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-26 </td>
   <td align="right"> 771 </td>
   <td align="right"> 1216 </td>
   <td align="right"> 1698 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-31 </td>
   <td align="right"> 812 </td>
   <td align="right"> 1261 </td>
   <td align="right"> 1871 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-05 </td>
   <td align="right"> 861 </td>
   <td align="right"> 1424 </td>
   <td align="right"> 2081 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-07 </td>
   <td align="right"> 861 </td>
   <td align="right"> 1424 </td>
   <td align="right"> 2407 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-09 </td>
   <td align="right"> 899 </td>
   <td align="right"> 1478 </td>
   <td align="right"> 2407 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-10 </td>
   <td align="right"> 936 </td>
   <td align="right"> 1620 </td>
   <td align="right"> 2407 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-13 </td>
   <td align="right"> 942 </td>
   <td align="right"> 1673 </td>
   <td align="right"> 2710 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-14 </td>
   <td align="right"> 942 </td>
   <td align="right"> 1673 </td>
   <td align="right"> 3022 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-17 </td>
   <td align="right"> 1008 </td>
   <td align="right"> 1673 </td>
   <td align="right"> 3022 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-19 </td>
   <td align="right"> 1008 </td>
   <td align="right"> 1813 </td>
   <td align="right"> 3022 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-20 </td>
   <td align="right"> 1022 </td>
   <td align="right"> 1940 </td>
   <td align="right"> 3280 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-21 </td>
   <td align="right"> 1074 </td>
   <td align="right"> 2021 </td>
   <td align="right"> 3458 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-23 </td>
   <td align="right"> 1157 </td>
   <td align="right"> 2304 </td>
   <td align="right"> 3696 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-28 </td>
   <td align="right"> 1199 </td>
   <td align="right"> 2437 </td>
   <td align="right"> 3834 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-01 </td>
   <td align="right"> 1199 </td>
   <td align="right"> 2437 </td>
   <td align="right"> 3924 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-04 </td>
   <td align="right"> 1298 </td>
   <td align="right"> 2789 </td>
   <td align="right"> 3924 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-05 </td>
   <td align="right"> 1350 </td>
   <td align="right"> 2789 </td>
   <td align="right"> 4076 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-07 </td>
   <td align="right"> 1350 </td>
   <td align="right"> 2950 </td>
   <td align="right"> 4076 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-08 </td>
   <td align="right"> 1350 </td>
   <td align="right"> 2950 </td>
   <td align="right"> 4249 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-11 </td>
   <td align="right"> 1472 </td>
   <td align="right"> 3252 </td>
   <td align="right"> 4249 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-12 </td>
   <td align="right"> 1472 </td>
   <td align="right"> 3252 </td>
   <td align="right"> 4262 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-13 </td>
   <td align="right"> 1519 </td>
   <td align="right"> 3410 </td>
   <td align="right"> 4262 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-14 </td>
   <td align="right"> 1519 </td>
   <td align="right"> 3410 </td>
   <td align="right"> 4665 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-18 </td>
   <td align="right"> 1540 </td>
   <td align="right"> 3706 </td>
   <td align="right"> 4665 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-19 </td>
   <td align="right"> 1553 </td>
   <td align="right"> 3706 </td>
   <td align="right"> 4665 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-21 </td>
   <td align="right"> 1553 </td>
   <td align="right"> 3896 </td>
   <td align="right"> 4665 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-22 </td>
   <td align="right"> 1553 </td>
   <td align="right"> 3896 </td>
   <td align="right"> 6525 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-25 </td>
   <td align="right"> 1667 </td>
   <td align="right"> 4759 </td>
   <td align="right"> 6525 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-27 </td>
   <td align="right"> 1667 </td>
   <td align="right"> 4759 </td>
   <td align="right"> 6525 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-29 </td>
   <td align="right"> 1667 </td>
   <td align="right"> 4759 </td>
   <td align="right"> 6525 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-31 </td>
   <td align="right"> 1731 </td>
   <td align="right"> 4759 </td>
   <td align="right"> 6525 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-02 </td>
   <td align="right"> 1760 </td>
   <td align="right"> 4759 </td>
   <td align="right"> 6525 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-03 </td>
   <td align="right"> 1760 </td>
   <td align="right"> 4862 </td>
   <td align="right"> 6619 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-04 </td>
   <td align="right"> 1760 </td>
   <td align="right"> 4862 </td>
   <td align="right"> 6822 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-08 </td>
   <td align="right"> 1878 </td>
   <td align="right"> 5368 </td>
   <td align="right"> 6822 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-09 </td>
   <td align="right"> 1878 </td>
   <td align="right"> 5368 </td>
   <td align="right"> 6878 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-10 </td>
   <td align="right"> 1919 </td>
   <td align="right"> 5586 </td>
   <td align="right"> 6878 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-11 </td>
   <td align="right"> 1919 </td>
   <td align="right"> 5586 </td>
   <td align="right"> 7069 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-15 </td>
   <td align="right"> 1971 </td>
   <td align="right"> 6073 </td>
   <td align="right"> 7069 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-16 </td>
   <td align="right"> 2047 </td>
   <td align="right"> 6190 </td>
   <td align="right"> 7082 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-18 </td>
   <td align="right"> 2047 </td>
   <td align="right"> 6190 </td>
   <td align="right"> 7168 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-22 </td>
   <td align="right"> 2134 </td>
   <td align="right"> 6599 </td>
   <td align="right"> 7168 </td>
  </tr>
</tbody>
</table>

</div>
<p>
This graph and corresponding table represent cumulative counts, but because case reports can be revised downward due to non-Ebola illnesses the graphs are not strictly monotone. A quick, but effective solution to this problem is to simply "un-cumulate" the data and bound it at zero to get a rough estimate of new case counts over time. 
<br/>
</p>
<button class="btn btn-default code-button">Show/Hide Code Block</button>
<div class="code-and-output-block" style="display:none">
<div class="chunk" id="CreateDataset"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># The &quot;I_star&quot; name will make more sense in a bit</span>
<span class="hl std">I_star</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(</span><span class="hl kwd">uncumulate</span><span class="hl std">(Guinea),</span>
               <span class="hl kwd">uncumulate</span><span class="hl std">(Liberia),</span>
               <span class="hl kwd">uncumulate</span><span class="hl std">(Sierra.Leone))</span>
<span class="hl std">I0</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(Guinea[</span><span class="hl num">1</span><span class="hl std">], Liberia[</span><span class="hl num">1</span><span class="hl std">], Sierra.Leone[</span><span class="hl num">1</span><span class="hl std">])</span>

<span class="hl com"># Define the temporal offset vector to be the number of days reflected in each </span>
<span class="hl com"># aggregated record (time between reports).</span>
<span class="hl std">offsets</span> <span class="hl kwb">=</span> <span class="hl kwd">uncumulate</span><span class="hl std">(original.rptDate)</span>
<span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl kwd">any</span><span class="hl std">(offsets</span> <span class="hl opt">&lt;=</span> <span class="hl num">0</span><span class="hl std">))</span>
<span class="hl std">{</span>
    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Invalid Date Information. The data source has likely changed.\n&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">stop</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)</span>
<span class="hl std">}</span>

<span class="hl std">InfectionPerDay</span> <span class="hl kwb">=</span> <span class="hl std">I_star</span><span class="hl opt">/</span><span class="hl std">(</span><span class="hl kwd">cbind</span><span class="hl std">(offsets, offsets, offsets))</span>

<span class="hl com"># Define figure 2 for next section</span>

<span class="hl std">figure2</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
    <span class="hl std">ylim</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl kwd">max</span><span class="hl std">(InfectionPerDay)</span><span class="hl opt">*</span><span class="hl num">1.2</span><span class="hl std">)</span>
    <span class="hl kwd">layout</span><span class="hl std">(</span><span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">),</span> <span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">),</span>
        <span class="hl kwc">widths</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">8</span><span class="hl std">,</span><span class="hl num">4</span><span class="hl std">),</span> <span class="hl kwc">heights</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">4</span><span class="hl std">,</span><span class="hl num">4</span><span class="hl std">))</span>
    <span class="hl kwd">plot</span><span class="hl std">(rptDate, InfectionPerDay[,</span><span class="hl num">1</span><span class="hl std">],</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Crude Guess at New Case Counts Per Day&quot;</span><span class="hl std">,</span>
         <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span>
         <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;New Cases&quot;</span><span class="hl std">,</span>
         <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span>
         <span class="hl kwc">ylim</span> <span class="hl std">= ylim,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span>
         <span class="hl std">)</span>
    <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">1000</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">lines</span><span class="hl std">(rptDate, InfectionPerDay[,</span><span class="hl num">2</span><span class="hl std">],</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span><span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
    <span class="hl kwd">lines</span><span class="hl std">(rptDate, InfectionPerDay[,</span><span class="hl num">3</span><span class="hl std">],</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">xaxt</span><span class="hl std">=</span><span class="hl str">&quot;n&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">yaxt</span><span class="hl std">=</span><span class="hl str">&quot;n&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">bty</span><span class="hl std">=</span><span class="hl str">&quot;n&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">xpd</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>
    <span class="hl kwd">plot</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">),</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">10</span><span class="hl std">),</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;n&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span>  <span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">,</span><span class="hl kwc">xlab</span><span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">,</span><span class="hl kwc">ylab</span><span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">legend</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=</span><span class="hl opt">-</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl kwc">y</span><span class="hl std">=</span><span class="hl num">10</span><span class="hl std">,</span> <span class="hl kwc">legend</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Guinea&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Liberia&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Sierra Leone&quot;</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">3</span><span class="hl std">,</span><span class="hl kwc">lwd</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span>
           <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">))</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">xpd</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">xaxt</span><span class="hl std">=</span><span class="hl str">&quot;s&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">yaxt</span><span class="hl std">=</span><span class="hl str">&quot;s&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">bty</span><span class="hl std">=</span><span class="hl str">&quot;o&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
</div>


<p>
  For better graphical representation, the "un-cumulated" counts are scaled to represent average number of infections per day, and linearly interpolated. The process is a bit noisier from this perspective when compared to the original cumulative counts.  
</p>

<div class="chunk" id="PlotFigure2"><div class="rimage center"><img src="figure/PlotFigure2.png" title="plot of chunk PlotFigure2" alt="plot of chunk PlotFigure2" class="plot" /></div></div>

<br/>

One can also represent this data geographically to get an idea of the spatial epidemic pattern, and to place the problem in a more relatable context. 

<h4 align=center>Average Number of Infections Per Day:</h4>
<div class="chunk" id="MakeMap1"><div class="rcode"><div class="error"><pre class="knitr r">## Error: there is no package called 'rCharts'
</pre></div>
</div></div>


<div class='container' ng-app="data_app" ng-controller='rChartsCtrl' id ="zoom_map_container" style="position: relative; max-width: 100%; height:100%">
  <div class = "row">
    <div class="col-sm-3">
      <input id='zoom-map-slider' type='range' min=1 max=
246
      ng-model='Day' width=200>
       <span>Day: <span id ="zoom-map-day-counter"></span></span>
    </div>
    <div class="col-sm-1">  <button class="btn btn-mini btn-primary" id="zoom-map-play" type="button">Play</button></div>
    <div class = "col-sm-6"></div>
  </div>
  <div class="row">
    <div id='zoom_map' class='rChart datamaps col-sm-8 col-sm-offset-1' style="position: relative; max-width: 100%; height:100%"></div>  
    <div class="col-sm-3"></div>
  </div>
</div>
<br/>
<br/>

      <a id="intro-compartment-sect" class="anchor">
      <h3>Compartmental Models</h3>
      </a>
      <p>
        Now that the data is read in (and now that we have several plots to suggest that we haven't done anything too terribly stupid with it)
        , let's do some compartmental epidemic modeling. Not only has Ebola been <a href="http://www.ncbi.nlm.nih.gov/pubmed/17156292">well modeled in the past</a> using compartmental modeling techniques, but this author happens to be working on a software library designed to fit compartmental models in the spatial SEIRS family. What a strange coincidence! Specifically, we'll be using heirarchical Bayesian estimation methods to fit a spatial SEIR model to the data.  
        </p>
        <br/>
        <br/>
        <p>
        While a full treatment of this field of epidemic modeling is (far) beyond the scope of this writing, the basic idea is pretty intuitive. In order to come up with a simplified model of a disease process, discrete disease states (aka, compartments) are defined. The most common of these are S, E, I, and R which stand for:<br>
      </p>
      <ul>
        <li><strong>S</strong>usceptible to a particular disease</li>
        <li><strong>E</strong>xposed and infected, but not yet infectious</li>
        <li><strong>I</strong>nfectious and capable of transmitting the disease</li>
        <li><strong>R</strong>emoved or recovered</li>
      </ul>
  <p>
    This sequence, traversed by members of a population (S to E to I to R), forms what we might call the temporal process model of our analysis. This analysis belongs to the stochastic branch of the compartmental modeling family, which has its roots in deterministic systems of ordinary and partial differential equations. In the stochastic framework, transitions between the compartments occur according to unknown probabilities. It is the S to E probability, which captures infection activity, into which we introduce spatial structure. Some details of this are given as comments to the code below, and more information than you probably want on the statistical particulars is available in <a href="https://github.com/grantbrown/libspatialSEIR/blob/master/doc/models/Ebola2014Analysis.pdf">this pdf document</a>. For now, suffice it to say that we'll place a simple spatial structure on the epidemic process which simply allows disease to spread between the three nations involved, and we'll try to estimate the strength of that relationship. Many other potential structures are possible, limited primarily by the amount of additional research and data compilation one is willing to do. </p><br/><br/>
<p>
For the purposes of this analysis, we will not do anything fancy with demographic information or public health intervention dates. Demographic parameters are relatively difficult to estimate here, as there are only four spatial units which are all from the same region. Intervention dates are more promising, but their inclusion requires much more background research than we have time for here. In the interest of simplicity and estimability, we'll just fit a different disease intensity parameter for each of the three countries to capture aggregate differences in Ebola susceptibility in addition to using a set of basis functions to capture the 
temporal trend. 
  </p>
    </div>
    <div class="col-sm-1">
    </div>
  </div>
    <div class="row">
    <div class = "col-sm-10 col-sm-offset-1">
    <!-- Polynomial analysis removed -->
    </div>
    <div class="col-sm-1"></div>
  </div>
<br/><br/>
 
  <a id="anchor-analysis-2-sect" class = "anchor">
  <h2>Analysis</h2> </a>
  
  <div class="row">
    <div class = "col-sm-10 col-sm-offset-1">
      <a id="analysis-2-set-up-sect" class="anchor"><h3>Set Up</h3></a>
  <p>
    There are some things we need to define before we can start fitting models and making predictions. 
  </p>
  <ol>
    <li>The population sizes need to be determined.</li>
    <li>Initial values for the four compartments must be determined.</li>
    <li>The time points are not evenly spaced, so we need to define appropriate offset values to capture the amount of aggregation performed (time between reports).</li>
    <li>We must define the spatial correlation structure.</li>
    <li>(optionally) A set of basis functions to capture the temporal trend.</li>
    <li>Prior parameters and parameter staring values must be specified for each <a href="http://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">chain.</a></li>
    <li>A whole bunch of bookkeeping stuff for which I haven't yet programmed sensible default behavior needs to be set up.</li>
  </ol>
  <p>
  Compartment starting values follow the usual convention of letting the entire initial population be divided into susceptibles and infectious individuals. The starting value for the number of infectious individuals was 86 for Guinea and zero for the other nations. Temporal offsets are actually calculated in the first code block (above) as the differences between the report times. For temporal basis functions, several options have been explored over the life of this project, including orthogonal polynomial and natural splines. The current analysis uses no temporal basis function, instead choosing to increase the granularity of the spatial correlation structure. Future work will introduce time varying intervention terms to quantify the effects of the early efforts of MSF and the ongoing international response.  Prior parameters for the E to I and I to R transitions were chosen based on well documented values for the average latent and infectious times, and the rest of the prior parameters were left vague. These decisions are addressed in more detail as comments to the code below. 
  </p>
  <br/>
  <br/>
  
<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="BuildVariables"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(splines)</span>
<span class="hl com"># Guinea, Liberia, Sierra Leone, Nigeria</span>
<span class="hl std">N</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">10057975</span><span class="hl std">,</span> <span class="hl num">4128572</span><span class="hl std">,</span> <span class="hl num">6190280</span><span class="hl std">),</span> <span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(I_star),</span><span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span>
           <span class="hl kwc">byrow</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl std">X</span> <span class="hl kwb">=</span> <span class="hl kwd">diag</span><span class="hl std">(</span><span class="hl kwd">ncol</span><span class="hl std">(N))</span>
<span class="hl std">X.predict</span> <span class="hl kwb">=</span> <span class="hl std">X</span>

<span class="hl std">daysSinceJan</span> <span class="hl kwb">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(rptDate</span> <span class="hl opt">-</span> <span class="hl kwd">as.Date</span><span class="hl std">(</span><span class="hl str">&quot;2014-01-01&quot;</span><span class="hl std">))</span>
<span class="hl std">daysSinceJan.predict</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">max</span><span class="hl std">(daysSinceJan)</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">max</span><span class="hl std">(daysSinceJan)</span>
                         <span class="hl opt">+</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,pred.days</span><span class="hl opt">-</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">))</span>
<span class="hl std">{</span>
<span class="hl kwa">if</span> <span class="hl std">(modelDF</span> <span class="hl opt">!=</span> <span class="hl num">0</span> <span class="hl opt">&amp;&amp;</span> <span class="hl std">modelMode</span> <span class="hl opt">==</span> <span class="hl str">&quot;DF&quot;</span><span class="hl std">)</span>
<span class="hl std">{</span>
  <span class="hl std">splineBasis</span> <span class="hl kwb">=</span> <span class="hl kwd">ns</span><span class="hl std">(daysSinceJan,</span> <span class="hl kwc">df</span> <span class="hl std">= modelDF)</span>
  <span class="hl std">splineBasis.predict</span> <span class="hl kwb">=</span> <span class="hl kwd">predict</span><span class="hl std">(splineBasis, daysSinceJan.predict)</span>
  <span class="hl std">Z</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(splineBasis,</span> <span class="hl kwc">ncol</span> <span class="hl std">= modelDF)</span>
  <span class="hl std">Z.predict</span> <span class="hl kwb">=</span> <span class="hl std">splineBasis.predict</span>
  <span class="hl com"># These co-variates are the same for each spatial location, </span>
  <span class="hl com"># so duplicate them row-wise. </span>
  <span class="hl std">Z</span> <span class="hl kwb">=</span> <span class="hl std">Z[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(Z),</span> <span class="hl kwd">nrow</span><span class="hl std">(X)),,</span><span class="hl kwc">drop</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">]</span>
  <span class="hl std">Z.predict</span> <span class="hl kwb">=</span> <span class="hl std">Z.predict[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(Z.predict),</span> <span class="hl kwd">nrow</span><span class="hl std">(X)),,</span><span class="hl kwc">drop</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">]</span>

  <span class="hl com"># For convenience, let's combine X and Z for prediction.</span>
  <span class="hl std">X.pred</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(X.predict[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(X.predict),</span>
                               <span class="hl kwc">each</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(Z.predict)</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(X)),], Z.predict)</span>
<span class="hl std">}</span>
<span class="hl kwa">else if</span> <span class="hl std">(modelDF</span> <span class="hl opt">!=</span> <span class="hl num">0</span> <span class="hl opt">&amp;&amp;</span> <span class="hl std">modelMode</span> <span class="hl opt">==</span> <span class="hl str">&quot;Knots&quot;</span><span class="hl std">)</span>
<span class="hl std">{</span>
  <span class="hl std">splineBasis</span> <span class="hl kwb">=</span> <span class="hl kwd">ns</span><span class="hl std">(daysSinceJan,</span> <span class="hl kwc">knots</span> <span class="hl std">=</span> <span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">quantile</span><span class="hl std">(daysSinceJan,</span>
                                                        <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">length</span> <span class="hl std">= modelDF)))[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(modelDF</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)])</span>
  <span class="hl std">splineBasis.predict</span> <span class="hl kwb">=</span> <span class="hl kwd">predict</span><span class="hl std">(splineBasis, daysSinceJan.predict)</span>
  <span class="hl std">Z</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(splineBasis,</span> <span class="hl kwc">ncol</span> <span class="hl std">= modelDF)</span>
  <span class="hl std">Z.predict</span> <span class="hl kwb">=</span> <span class="hl std">splineBasis.predict</span>
  <span class="hl com"># These co-variates are the same for each spatial location, </span>
  <span class="hl com"># so duplicate them row-wise. </span>
  <span class="hl std">Z</span> <span class="hl kwb">=</span> <span class="hl std">Z[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(Z),</span> <span class="hl kwd">nrow</span><span class="hl std">(X)),,</span><span class="hl kwc">drop</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">]</span>
  <span class="hl std">Z.predict</span> <span class="hl kwb">=</span> <span class="hl std">Z.predict[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(Z.predict),</span> <span class="hl kwd">nrow</span><span class="hl std">(X)),,</span><span class="hl kwc">drop</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">]</span>

  <span class="hl com"># For convenience, let's combine X and Z for prediction.</span>
  <span class="hl std">X.pred</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(X.predict[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(X.predict),</span>
                               <span class="hl kwc">each</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(Z.predict)</span><span class="hl opt">/</span><span class="hl kwd">nrow</span><span class="hl std">(X)),], Z.predict)</span>
<span class="hl std">}</span>
<span class="hl kwa">else</span>
<span class="hl std">{</span>
  <span class="hl std">splineBasis</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">()</span>
  <span class="hl std">splineBasis.predict</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">()</span>
  <span class="hl std">Z</span> <span class="hl kwb">=</span> <span class="hl num">NA</span>
  <span class="hl std">Z.predict</span> <span class="hl kwb">=</span> <span class="hl num">NA</span>
  <span class="hl std">X.pred</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(X.predict[</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(X.predict),</span> <span class="hl kwc">each</span> <span class="hl std">=</span> <span class="hl kwd">length</span><span class="hl std">(daysSinceJan.predict)),])</span>
<span class="hl std">}</span>
<span class="hl std">}</span>
<span class="hl std">DM1</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0.5</span><span class="hl std">,</span><span class="hl num">0.5</span><span class="hl std">,</span>
               <span class="hl num">0.5</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0.5</span><span class="hl std">,</span>
               <span class="hl num">0.5</span><span class="hl std">,</span><span class="hl num">0.5</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">),</span> <span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">byrow</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl std">dmList</span> <span class="hl kwb">=</span> <span class="hl kwd">list</span><span class="hl std">(DM1)</span>


<span class="hl com"># Define prediction offsets. </span>
<span class="hl std">offset.pred</span> <span class="hl kwb">=</span> <span class="hl kwd">uncumulate</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,pred.days</span><span class="hl opt">-</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">)))</span>


<span class="hl com"># There's no reinfection process for Ebola, but we still need to provide dummy</span>
<span class="hl com"># values for the reinfection terms. This will be changed (along with most of </span>
<span class="hl com"># the R level API) Dummy covariate matrix:</span>
<span class="hl std">X_p_rs</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span>

<span class="hl com"># Dummy value for reinfection params</span>
<span class="hl std">beta_p_rs</span> <span class="hl kwb">=</span> <span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwd">ncol</span><span class="hl std">(X_p_rs))</span>
<span class="hl com"># Dummy value for reinfection params prior precision</span>
<span class="hl std">betaPrsPriorPrecision</span> <span class="hl kwb">=</span> <span class="hl num">0.5</span>



<span class="hl com"># Declare prior parameters for the E to I and I to R probabilities. </span>

<span class="hl com"># Latent period between 1 and 21 days</span>
<span class="hl std">prior_gamma_ei</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">/</span><span class="hl num">5</span>
<span class="hl std">prior_gamma_ir</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">/</span><span class="hl num">7</span>
<span class="hl std">transitionEffectiveSampleSizes</span> <span class="hl kwb">=</span> <span class="hl num">10000</span>
<span class="hl kwd">hist</span><span class="hl std">(</span><span class="hl kwd">rgeom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">100000</span><span class="hl std">),</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">prior_gamma_ei)),</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Days&quot;</span><span class="hl std">,</span>
     <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Prior Distribution\n Ebola Latent Period&quot;</span><span class="hl std">,</span> <span class="hl kwc">freq</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/BuildVariables1.png" title="plot of chunk BuildVariables" alt="plot of chunk BuildVariables" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">hist</span><span class="hl std">(</span><span class="hl kwd">rgeom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">100000</span><span class="hl std">),</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">prior_gamma_ir)),</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Days&quot;</span><span class="hl std">,</span>
     <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Prior Distribution\n Ebola Infectious Period&quot;</span><span class="hl std">,</span> <span class="hl kwc">freq</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/BuildVariables2.png" title="plot of chunk BuildVariables" alt="plot of chunk BuildVariables" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># Declare prior parameters for the overdispersion precision</span>
<span class="hl std">priorAlpha_phi</span> <span class="hl kwb">=</span> <span class="hl num">10000</span>
<span class="hl std">priorBeta_phi</span> <span class="hl kwb">=</span> <span class="hl num">1500</span>

<span class="hl com"># Declare prior precision for exposure model paramters</span>
<span class="hl std">betaPriorPrecision</span> <span class="hl kwb">=</span> <span class="hl num">0.1</span>

<span class="hl com"># Declare a function which can come up with several different starting values </span>
<span class="hl com"># for the model parameters. This will allow us to assess convergence. </span>
<span class="hl std">proposeParameters</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">seedVal</span><span class="hl std">,</span> <span class="hl kwc">chainNumber</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl kwd">set.seed</span><span class="hl std">(seedVal)</span>

    <span class="hl com"># 2 to 21 day incubation period according to who</span>
    <span class="hl std">p_ei</span> <span class="hl kwb">=</span> <span class="hl num">0.25</span> <span class="hl opt">+</span> <span class="hl kwd">rnorm</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0.02</span><span class="hl std">)</span>
    <span class="hl com"># Up to 7 weeks even after recovery</span>
    <span class="hl std">p_ir</span> <span class="hl kwb">=</span> <span class="hl num">0.14</span> <span class="hl opt">+</span> <span class="hl kwd">rnorm</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0.01</span><span class="hl std">)</span>
    <span class="hl std">gamma_ei</span><span class="hl kwb">=</span><span class="hl opt">-</span><span class="hl kwd">log</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl std">p_ei)</span>
    <span class="hl std">gamma_ir</span><span class="hl kwb">=</span><span class="hl opt">-</span><span class="hl kwd">log</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl std">p_ir)</span>

    <span class="hl com"># Starting value for exposure regression parameters</span>
    <span class="hl std">beta</span> <span class="hl kwb">=</span> <span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwd">ncol</span><span class="hl std">(X)</span> <span class="hl opt">+</span> <span class="hl kwd">ifelse</span><span class="hl std">(</span><span class="hl kwd">all</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(Z)),</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwd">ncol</span><span class="hl std">(Z)))</span>
    <span class="hl std">beta[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">ncol</span><span class="hl std">(X))]</span> <span class="hl kwb">=</span> <span class="hl kwd">rnorm</span><span class="hl std">(</span><span class="hl kwd">ncol</span><span class="hl std">(X),</span> <span class="hl opt">-</span><span class="hl num">3</span><span class="hl std">,</span> <span class="hl num">3</span><span class="hl std">)</span>
    <span class="hl com">#beta[1] = 2.5 + rnorm(1,0,0.5)</span>

    <span class="hl std">phi</span> <span class="hl kwb">=</span> <span class="hl num">0.01</span> <span class="hl com"># Overdispersion precision</span>

    <span class="hl std">outFileName</span> <span class="hl kwb">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;./chain_output_ebola_&quot;</span><span class="hl std">, chainNumber ,</span><span class="hl str">&quot;.txt&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)</span>

    <span class="hl com"># Make a crude guess as to the true compartments:</span>
    <span class="hl com"># S_star, E_star, R_star, and thus S,E,I and R</span>
    <span class="hl std">DataModel</span> <span class="hl kwb">=</span> <span class="hl kwd">buildDataModel</span><span class="hl std">(I_star,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;overdispersion&quot;</span><span class="hl std">,</span>
                               <span class="hl kwc">params</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(priorAlpha_phi,priorBeta_phi))</span>
    <span class="hl std">ExposureModel</span> <span class="hl kwb">=</span> <span class="hl kwd">buildExposureModel</span><span class="hl std">(X, Z, beta, betaPriorPrecision, offsets,</span> <span class="hl kwc">nTpt</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(I_star))</span>
    <span class="hl std">ReinfectionModel</span> <span class="hl kwb">=</span> <span class="hl kwd">buildReinfectionModel</span><span class="hl std">(</span><span class="hl str">&quot;SEIR&quot;</span><span class="hl std">)</span>
    <span class="hl std">SamplingControl</span> <span class="hl kwb">=</span> <span class="hl kwd">buildSamplingControl</span><span class="hl std">(</span><span class="hl kwc">iterationStride</span><span class="hl std">=iterationStride,</span>
                                           <span class="hl kwc">sliceWidths</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl com"># S_star</span>
                                                         <span class="hl num">1</span><span class="hl std">,</span> <span class="hl com"># E_star</span>
                                                         <span class="hl num">1</span><span class="hl std">,</span>  <span class="hl com"># R_star</span>
                                                         <span class="hl num">1</span><span class="hl std">,</span>  <span class="hl com"># S_0</span>
                                                         <span class="hl num">1</span><span class="hl std">,</span>  <span class="hl com"># I_0</span>
                                                         <span class="hl num">0.05</span><span class="hl std">,</span>  <span class="hl com"># beta</span>
                                                         <span class="hl num">0.0</span><span class="hl std">,</span>  <span class="hl com"># beta_p_rs, fixed in this case</span>
                                                         <span class="hl num">0.01</span><span class="hl std">,</span> <span class="hl com"># rho</span>
                                                         <span class="hl num">0.01</span><span class="hl std">,</span> <span class="hl com"># gamma_ei</span>
                                                         <span class="hl num">0.01</span><span class="hl std">,</span>  <span class="hl com"># gamma_ir</span>
                                                         <span class="hl num">0.01</span><span class="hl std">))</span> <span class="hl com"># phi)</span>

    <span class="hl std">InitContainer</span> <span class="hl kwb">=</span> <span class="hl kwd">buildInitialValueContainer</span><span class="hl std">(I_star, N,</span>
                                               <span class="hl kwc">S0</span> <span class="hl std">= N[</span><span class="hl num">1</span><span class="hl std">,]</span><span class="hl opt">-</span><span class="hl std">I_star[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">-</span> <span class="hl num">2</span><span class="hl opt">*</span><span class="hl std">I0,</span>
                                               <span class="hl kwc">E0</span> <span class="hl std">= I0,</span>
                                               <span class="hl kwc">I0</span> <span class="hl std">= I0)</span>
    <span class="hl std">DistanceModel</span> <span class="hl kwb">=</span> <span class="hl kwd">buildDistanceModel</span><span class="hl std">(dmList,</span> <span class="hl kwc">priorAlpha</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">priorBeta</span> <span class="hl std">=</span> <span class="hl num">500</span><span class="hl std">)</span>
    <span class="hl std">TransitionPriors</span> <span class="hl kwb">=</span> <span class="hl kwd">buildTransitionPriorsFromProbabilities</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">prior_gamma_ei),</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">prior_gamma_ir),</span>
                                                              <span class="hl std">transitionEffectiveSampleSizes, transitionEffectiveSampleSizes)</span>
    <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">DataModel</span><span class="hl std">=DataModel,</span>
                <span class="hl kwc">ExposureModel</span><span class="hl std">=ExposureModel,</span>
                <span class="hl kwc">ReinfectionModel</span><span class="hl std">=ReinfectionModel,</span>
                <span class="hl kwc">SamplingControl</span><span class="hl std">=SamplingControl,</span>
                <span class="hl kwc">InitContainer</span><span class="hl std">=InitContainer,</span>
                <span class="hl kwc">DistanceModel</span><span class="hl std">=DistanceModel,</span>
                <span class="hl kwc">TransitionPriors</span><span class="hl std">=TransitionPriors,</span>
                <span class="hl kwc">outFileName</span><span class="hl std">=outFileName))</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
      </div>
  
  
<p>
  With the set up out of the way, we can finally build and run the models the models. The code presented below has recently (8/27/2014) been set up to use the "parallel" library which is included with the R statistical analysis software. While this allows us to spend considerably less time waiting for the document to compile, the code may be more difficult to understand for those unfamiliar with this useful parallelization library. The previous analyses, linked above, may be a better guide to the basic use of the spatialSEIR library for such users. 
</p>
<br/>  
  
<button class="btn btn-default code-button">Show/Hide Code Block</button>
      <div class="code-and-output-block" style="display:none">
<div class="chunk" id="BuildAndRunModel"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">paramsList</span> <span class="hl kwb">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;estimateR0&quot;</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">,</span> <span class="hl str">&quot;traceCompartments&quot;</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">,</span> <span class="hl str">&quot;seedVal&quot;</span><span class="hl std">=</span><span class="hl num">133</span><span class="hl std">,</span><span class="hl str">&quot;chainNumber&quot;</span><span class="hl std">=</span><span class="hl num">4</span><span class="hl std">),</span>
                  <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;estimateR0&quot;</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">,</span> <span class="hl str">&quot;traceCompartments&quot;</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">,</span> <span class="hl str">&quot;seedVal&quot;</span><span class="hl std">=</span><span class="hl num">1224</span><span class="hl std">,</span><span class="hl str">&quot;chainNumber&quot;</span><span class="hl std">=</span><span class="hl num">5</span><span class="hl std">),</span>
                  <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;estimateR0&quot;</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">,</span><span class="hl str">&quot;traceCompartments&quot;</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">,</span> <span class="hl str">&quot;seedVal&quot;</span><span class="hl std">=</span><span class="hl num">12325</span><span class="hl std">,</span><span class="hl str">&quot;chainNumber&quot;</span><span class="hl std">=</span><span class="hl num">6</span><span class="hl std">))</span>

<span class="hl std">buildAndBurnInModel</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">params</span><span class="hl std">)</span>
<span class="hl std">{</span>
  <span class="hl kwd">library</span><span class="hl std">(spatialSEIR)</span>
  <span class="hl com"># save proposal and params to node workspace</span>
  <span class="hl std">proposal</span> <span class="hl kwb">&lt;&lt;-</span> <span class="hl kwd">proposeParameters</span><span class="hl std">(params[[</span><span class="hl str">&quot;seedVal&quot;</span><span class="hl std">]], params[[</span><span class="hl str">&quot;chainNumber&quot;</span><span class="hl std">]])</span>
  <span class="hl std">params</span> <span class="hl kwb">&lt;&lt;-</span> <span class="hl std">params</span>
  <span class="hl std">SEIRmodel</span> <span class="hl kwb">=</span>  <span class="hl kwd">buildSEIRModel</span><span class="hl std">(proposal</span><span class="hl opt">$</span><span class="hl std">outFileName,</span>
                              <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">DataModel,</span>
                              <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">ExposureModel,</span>
                              <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">ReinfectionModel,</span>
                              <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">DistanceModel,</span>
                              <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">TransitionPriors,</span>
                              <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">InitContainer,</span>
                              <span class="hl std">proposal</span><span class="hl opt">$</span><span class="hl std">SamplingControl)</span>

  <span class="hl std">SEIRmodel</span><span class="hl opt">$</span><span class="hl kwd">setRandomSeed</span><span class="hl std">(params[[</span><span class="hl str">&quot;seedVal&quot;</span><span class="hl std">]])</span>
  <span class="hl com"># Save model object to node workspace</span>
  <span class="hl std">localModelObject</span> <span class="hl kwb">&lt;&lt;-</span> <span class="hl std">SEIRmodel</span>

  <span class="hl com"># Do we need to keep track of compartment values for prediction? </span>
  <span class="hl com"># No sense doing this for all of the chains.</span>
  <span class="hl kwa">if</span> <span class="hl std">(params[[</span><span class="hl str">&quot;traceCompartments&quot;</span><span class="hl std">]])</span>
  <span class="hl std">{</span>
    <span class="hl std">SEIRmodel</span><span class="hl opt">$</span><span class="hl kwd">setTrace</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl com">#Guinea </span>
    <span class="hl std">SEIRmodel</span><span class="hl opt">$</span><span class="hl kwd">setTrace</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">)</span> <span class="hl com">#Liberia</span>
    <span class="hl std">SEIRmodel</span><span class="hl opt">$</span><span class="hl kwd">setTrace</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">)</span> <span class="hl com">#Sierra Leone</span>
  <span class="hl std">}</span>

  <span class="hl com"># Make a helper function to run each chain, as well as update the metropolis </span>
  <span class="hl com"># tuning parameters. </span>
  <span class="hl std">runSimulation</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">modelObject</span><span class="hl std">,</span>
                           <span class="hl kwc">numBatches</span><span class="hl std">=</span><span class="hl num">500</span><span class="hl std">,</span>
                           <span class="hl kwc">batchSize</span><span class="hl std">=</span><span class="hl num">20</span><span class="hl std">,</span>
                           <span class="hl kwc">targetAcceptanceRatio</span><span class="hl std">=</span><span class="hl num">0.2</span><span class="hl std">,</span>
                           <span class="hl kwc">tolerance</span><span class="hl std">=</span><span class="hl num">0.05</span><span class="hl std">,</span>
                           <span class="hl kwc">proportionChange</span> <span class="hl std">=</span> <span class="hl num">0.1</span>
                          <span class="hl std">)</span>
  <span class="hl std">{</span>
      <span class="hl kwa">for</span> <span class="hl std">(batch</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">numBatches)</span>
      <span class="hl std">{</span>
          <span class="hl std">modelObject</span><span class="hl opt">$</span><span class="hl kwd">simulate</span><span class="hl std">(batchSize)</span>
          <span class="hl std">modelObject</span><span class="hl opt">$</span><span class="hl kwd">updateSamplingParameters</span><span class="hl std">(targetAcceptanceRatio,</span>
                                               <span class="hl std">tolerance,</span>
                                               <span class="hl std">proportionChange)</span>
      <span class="hl std">}</span>
  <span class="hl std">}</span>

  <span class="hl com"># Burn in tuning parameters</span>
  <span class="hl kwd">runSimulation</span><span class="hl std">(SEIRmodel,</span> <span class="hl kwc">numBatches</span> <span class="hl std">= numBurnInBatches)</span>
  <span class="hl kwd">runSimulation</span><span class="hl std">(SEIRmodel,</span> <span class="hl kwc">batchSize</span> <span class="hl std">=</span> <span class="hl num">100</span><span class="hl std">,</span> <span class="hl kwc">numBatches</span> <span class="hl std">= numBurnInBatches)</span>

  <span class="hl std">SEIRmodel</span><span class="hl opt">$</span><span class="hl std">compartmentSamplingMode</span> <span class="hl kwb">=</span> <span class="hl num">17</span>
  <span class="hl std">SEIRmodel</span><span class="hl opt">$</span><span class="hl std">performHybridStep</span> <span class="hl kwb">=</span> <span class="hl num">10</span>
  <span class="hl kwa">if</span> <span class="hl std">(modelDF</span> <span class="hl opt">&gt;</span> <span class="hl num">0</span><span class="hl std">)</span>
  <span class="hl std">{</span>
      <span class="hl std">SEIRmodel</span><span class="hl opt">$</span><span class="hl std">useDecorrelation</span> <span class="hl kwb">=</span> <span class="hl num">10</span>
  <span class="hl std">}</span>
<span class="hl std">}</span>


<span class="hl std">finishSimulation</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">iterationNumber</span><span class="hl std">)</span>
<span class="hl std">{</span>
  <span class="hl std">dat</span> <span class="hl kwb">=</span> <span class="hl kwd">read.csv</span><span class="hl std">(proposal</span><span class="hl opt">$</span><span class="hl std">outFileName)</span>

  <span class="hl com">## Do we need to estimate R0 for this chain?</span>
  <span class="hl kwa">if</span> <span class="hl std">(params[[</span><span class="hl str">&quot;estimateR0&quot;</span><span class="hl std">]])</span>
  <span class="hl std">{</span>
    <span class="hl std">R0</span> <span class="hl kwb">=</span> <span class="hl kwd">array</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">dim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star),</span> <span class="hl kwd">ncol</span><span class="hl std">(I_star), extraR0Iterations))</span>
    <span class="hl std">effectiveR0</span> <span class="hl kwb">=</span> <span class="hl kwd">array</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">dim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star),</span> <span class="hl kwd">ncol</span><span class="hl std">(I_star), extraR0Iterations))</span>
    <span class="hl std">empiricalR0</span> <span class="hl kwb">=</span> <span class="hl kwd">array</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">dim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star),</span> <span class="hl kwd">ncol</span><span class="hl std">(I_star), extraR0Iterations))</span>
    <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">extraR0Iterations)</span>
    <span class="hl std">{</span>
        <span class="hl std">localModelObject</span><span class="hl opt">$</span><span class="hl kwd">simulate</span><span class="hl std">(extraR0BatchSize)</span>
        <span class="hl kwa">for</span> <span class="hl std">(j</span> <span class="hl kwa">in</span> <span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">))</span>
        <span class="hl std">{</span>
            <span class="hl std">R0[j,,i]</span> <span class="hl kwb">=</span> <span class="hl std">localModelObject</span><span class="hl opt">$</span><span class="hl kwd">estimateR0</span><span class="hl std">(j)</span>
            <span class="hl std">effectiveR0[j,,i]</span> <span class="hl kwb">=</span> <span class="hl std">localModelObject</span><span class="hl opt">$</span><span class="hl kwd">estimateEffectiveR0</span><span class="hl std">(j)</span>
            <span class="hl std">empiricalR0[j,,i]</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(localModelObject</span><span class="hl opt">$</span><span class="hl kwd">getIntegratedGenerationMatrix</span><span class="hl std">(j),</span> <span class="hl num">1</span><span class="hl std">, sum)</span>
        <span class="hl std">}</span>
    <span class="hl std">}</span>

    <span class="hl std">R0Mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(R0,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">, mean)</span>
    <span class="hl std">R0LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(R0,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl num">0.05</span><span class="hl std">)</span>
    <span class="hl std">R0UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(R0,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl num">0.95</span><span class="hl std">)</span>
    <span class="hl std">effectiveR0Mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(effectiveR0,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">, mean)</span>
    <span class="hl std">effectiveR0LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(effectiveR0,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl num">0.05</span><span class="hl std">)</span>
    <span class="hl std">effectiveR0UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(effectiveR0,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl num">0.95</span><span class="hl std">)</span>
    <span class="hl std">empiricalR0Mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(empiricalR0,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">, mean)</span>
    <span class="hl std">empiricalR0LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(empiricalR0,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl num">0.05</span><span class="hl std">)</span>
    <span class="hl std">empiricalR0UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(empiricalR0,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl num">0.95</span><span class="hl std">)</span>
    <span class="hl std">orig.R0</span> <span class="hl kwb">=</span> <span class="hl std">R0</span>
    <span class="hl std">R0</span> <span class="hl kwb">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;R0&quot;</span> <span class="hl std">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;mean&quot;</span><span class="hl std">=R0Mean,</span> <span class="hl str">&quot;LB&quot;</span> <span class="hl std">= R0LB,</span> <span class="hl str">&quot;UB&quot;</span> <span class="hl std">= R0UB),</span>
              <span class="hl str">&quot;effectiveR0&quot;</span> <span class="hl std">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;mean&quot;</span><span class="hl std">=effectiveR0Mean,</span> <span class="hl str">&quot;LB&quot;</span> <span class="hl std">= effectiveR0LB,</span>
                                   <span class="hl str">&quot;UB&quot;</span> <span class="hl std">= effectiveR0UB),</span>
              <span class="hl str">&quot;empiricalR0&quot;</span> <span class="hl std">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;mean&quot;</span><span class="hl std">=empiricalR0Mean,</span> <span class="hl str">&quot;LB&quot;</span> <span class="hl std">= empiricalR0LB,</span>
                                   <span class="hl str">&quot;UB&quot;</span> <span class="hl std">= empiricalR0UB))</span>
  <span class="hl std">}</span> <span class="hl kwa">else</span>
  <span class="hl std">{</span>
     <span class="hl std">R0</span> <span class="hl kwb">=</span> <span class="hl kwa">NULL</span>
     <span class="hl std">orig.R0</span> <span class="hl kwb">=</span> <span class="hl kwa">NULL</span>
  <span class="hl std">}</span>

  <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">list</span><span class="hl std">(</span><span class="hl str">&quot;chainOutput&quot;</span> <span class="hl std">= dat,</span> <span class="hl str">&quot;R0&quot;</span> <span class="hl std">= R0,</span> <span class="hl str">&quot;rawSamples&quot;</span> <span class="hl std">= orig.R0))</span>
<span class="hl std">}</span>


<span class="hl std">cl</span> <span class="hl kwb">=</span> <span class="hl kwd">makeCluster</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">outfile</span> <span class="hl std">=</span> <span class="hl str">&quot;err.txt&quot;</span><span class="hl std">)</span>
<span class="hl kwd">clusterExport</span><span class="hl std">(cl,</span> <span class="hl kwd">c</span><span class="hl std">(</span> <span class="hl str">&quot;offsets&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;X&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;Z&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;I0&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;X_p_rs&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;prior_gamma_ei&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;prior_gamma_ir&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;transitionEffectiveSampleSizes&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;priorAlpha_phi&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;priorBeta_phi&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;betaPriorPrecision&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;beta_p_rs&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;betaPrsPriorPrecision&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;N&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;dmList&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;iterationStride&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;proposeParameters&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;generateCompartmentProposal&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;extraR0Iterations&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;extraR0BatchSize&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;I_star&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;modelDF&quot;</span><span class="hl std">,</span>
                     <span class="hl str">&quot;numBurnInBatches&quot;</span><span class="hl std">))</span>


<span class="hl std">additionalIterations</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">params</span><span class="hl std">)</span>
<span class="hl std">{</span>

    <span class="hl std">N</span> <span class="hl kwb">=</span> <span class="hl std">params[[</span><span class="hl num">1</span><span class="hl std">]]</span>
    <span class="hl std">batchSize</span> <span class="hl kwb">=</span> <span class="hl std">params[[</span><span class="hl num">2</span><span class="hl std">]]</span>
    <span class="hl std">targetRatio</span> <span class="hl kwb">=</span> <span class="hl std">params[[</span><span class="hl num">3</span><span class="hl std">]]</span>
    <span class="hl std">targetWidth</span><span class="hl kwb">=</span><span class="hl std">params[[</span><span class="hl num">4</span><span class="hl std">]]</span>
    <span class="hl std">proportionChange</span> <span class="hl kwb">=</span> <span class="hl std">params[[</span><span class="hl num">5</span><span class="hl std">]]</span>
    <span class="hl std">updateParameters</span> <span class="hl kwb">=</span> <span class="hl std">params[[</span><span class="hl num">6</span><span class="hl std">]]</span>
    <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(N</span><span class="hl opt">/</span><span class="hl std">batchSize))</span>
    <span class="hl std">{</span>
        <span class="hl std">localModelObject</span><span class="hl opt">$</span><span class="hl kwd">simulate</span><span class="hl std">(batchSize)</span>
        <span class="hl kwa">if</span> <span class="hl std">(updateParameters)</span>
        <span class="hl std">{</span>
            <span class="hl std">localModelObject</span><span class="hl opt">$</span><span class="hl kwd">updateSamplingParameters</span><span class="hl std">(targetRatio, targetWidth, proportionChange)</span>
        <span class="hl std">}</span>
    <span class="hl std">}</span>
<span class="hl std">}</span>


<span class="hl std">iterationParams</span> <span class="hl kwb">=</span> <span class="hl kwd">list</span><span class="hl std">(convergenceSampleSize, convergenceBatchSize,</span>
                       <span class="hl kwc">targetAcceptanceRatio</span><span class="hl std">=</span><span class="hl num">0.2</span><span class="hl std">,</span>
                       <span class="hl kwc">tolerance</span><span class="hl std">=</span><span class="hl num">0.05</span><span class="hl std">,</span>
                       <span class="hl kwc">proportionChange</span> <span class="hl std">=</span> <span class="hl num">0.1</span><span class="hl std">,</span>
                       <span class="hl kwc">updateSamplingParams</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
<span class="hl std">iterationParams</span> <span class="hl kwb">=</span> <span class="hl kwd">list</span><span class="hl std">(iterationParams, iterationParams, iterationParams)</span>
<span class="hl std">fileNames</span> <span class="hl kwb">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;chain_output_ebola_&quot;</span><span class="hl std">,</span> <span class="hl kwd">c</span><span class="hl std">(paramsList[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">chainNumber,</span>
                        <span class="hl std">paramsList[[</span><span class="hl num">2</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">chainNumber,</span>
                        <span class="hl std">paramsList[[</span><span class="hl num">3</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">chainNumber),</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">),</span> <span class="hl str">&quot;.txt&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)</span>
<span class="hl std">chains</span> <span class="hl kwb">=</span> <span class="hl kwd">parLapply</span><span class="hl std">(cl, paramsList, buildAndBurnInModel)</span>

<span class="hl std">conv</span> <span class="hl kwb">=</span> <span class="hl num">FALSE</span>
<span class="hl kwa">while</span> <span class="hl std">(</span><span class="hl opt">!</span><span class="hl std">conv)</span>
<span class="hl std">{</span>
    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Not converged, adding iterations. Total so far: &quot;</span><span class="hl std">, totalSamples,</span>
              <span class="hl str">&quot;\n&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">))</span>
    <span class="hl kwd">parLapply</span><span class="hl std">(cl, iterationParams, additionalIterations)</span>
    <span class="hl std">totalSamples</span> <span class="hl kwb">=</span> <span class="hl std">totalSamples</span> <span class="hl opt">+</span> <span class="hl std">convergenceSampleSize</span>
    <span class="hl std">conv</span> <span class="hl kwb">=</span> <span class="hl kwd">checkConvergence</span><span class="hl std">(fileNames[</span><span class="hl num">1</span><span class="hl std">], fileNames[</span><span class="hl num">2</span><span class="hl std">], fileNames[</span><span class="hl num">3</span><span class="hl std">],</span> <span class="hl kwc">maxVal</span> <span class="hl std">= convergenceCriterion)</span>
    <span class="hl std">conv</span> <span class="hl kwb">=</span> <span class="hl std">(conv</span> <span class="hl opt">&amp;&amp;</span> <span class="hl std">(minimumSamples</span> <span class="hl opt">&lt;</span> <span class="hl std">totalSamples))</span>
<span class="hl std">}</span>
</pre></div>
<div class="output"><pre class="knitr r">## Not converged, adding iterations. Total so far: 0
## Convergence Criterion: 1.16, param: BetaP_SE_6
## Not converged, adding iterations. Total so far: 1e+05
## Convergence Criterion: 1.06, param: BetaP_SE_7
## Not converged, adding iterations. Total so far: 2e+05
## Convergence Criterion: 1.14, param: BetaP_SE_7
## Not converged, adding iterations. Total so far: 3e+05
## Convergence Criterion: 1.14, param: BetaP_SE_7
## Not converged, adding iterations. Total so far: 4e+05
## Convergence Criterion: 1.19, param: BetaP_SE_2
## Not converged, adding iterations. Total so far: 5e+05
## Convergence Criterion: 1.24, param: BetaP_SE_2
## Not converged, adding iterations. Total so far: 6e+05
## Convergence Criterion: 1.24, param: BetaP_SE_2
## Not converged, adding iterations. Total so far: 7e+05
## Convergence Criterion: 1.18, param: BetaP_SE_2
## Not converged, adding iterations. Total so far: 8e+05
## Convergence Criterion: 1.18, param: BetaP_SE_2
## Not converged, adding iterations. Total so far: 9e+05
## Convergence Criterion: 1.17, param: BetaP_SE_2
## Not converged, adding iterations. Total so far: 1e+06
## Convergence Criterion: 1.13, param: BetaP_SE_6
## Not converged, adding iterations. Total so far: 1100000
## Convergence Criterion: 1.15, param: BetaP_SE_6
## Not converged, adding iterations. Total so far: 1200000
## Convergence Criterion: 1.1, param: BetaP_SE_6
## Not converged, adding iterations. Total so far: 1300000
## Convergence Criterion: 1.12, param: gamma_ei
## Not converged, adding iterations. Total so far: 1400000
## Convergence Criterion: 1.13, param: gamma_ei
## Not converged, adding iterations. Total so far: 1500000
## Convergence Criterion: 1.14, param: gamma_ei
## Not converged, adding iterations. Total so far: 1600000
## Convergence Criterion: 1.16, param: gamma_ei
## Not converged, adding iterations. Total so far: 1700000
## Convergence Criterion: 1.18, param: gamma_ei
## Not converged, adding iterations. Total so far: 1800000
## Convergence Criterion: 1.18, param: gamma_ei
## Not converged, adding iterations. Total so far: 1900000
## Convergence Criterion: 1.18, param: gamma_ei
## Not converged, adding iterations. Total so far: 2e+06
## Convergence Criterion: 1.15, param: gamma_ei
## Not converged, adding iterations. Total so far: 2100000
## Convergence Criterion: 1.13, param: gamma_ei
## Not converged, adding iterations. Total so far: 2200000
## Convergence Criterion: 1.09, param: gamma_ei
## Not converged, adding iterations. Total so far: 2300000
## Convergence Criterion: 1.07, param: gamma_ei
## Not converged, adding iterations. Total so far: 2400000
## Convergence Criterion: 1.04, param: gamma_ei
## Not converged, adding iterations. Total so far: 2500000
## Convergence Criterion: 1.03, param: gamma_ei
## Not converged, adding iterations. Total so far: 2600000
## Convergence Criterion: 1.03, param: gamma_ir
## Not converged, adding iterations. Total so far: 2700000
## Convergence Criterion: 1.03, param: gamma_ir
## Not converged, adding iterations. Total so far: 2800000
## Convergence Criterion: 1.02, param: gamma_ir
## Not converged, adding iterations. Total so far: 2900000
## Convergence Criterion: 1.01, param: gamma_ir
## Not converged, adding iterations. Total so far: 3e+06
## Convergence Criterion: 1.01, param: gamma_ir
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Chains converged, finishing up...\n&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Chains converged, finishing up...
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">cleanUpParamsList</span> <span class="hl kwb">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">3</span><span class="hl std">)</span>
<span class="hl std">chains</span> <span class="hl kwb">=</span> <span class="hl kwd">parLapply</span><span class="hl std">(cl, cleanUpParamsList, finishSimulation)</span>
<span class="hl kwd">save</span><span class="hl std">(</span><span class="hl str">&quot;chains&quot;</span><span class="hl std">,</span> <span class="hl kwc">file</span><span class="hl std">=</span><span class="hl str">&quot;./chainOutput.Robj&quot;</span><span class="hl std">)</span>
<span class="hl kwd">stopCluster</span><span class="hl std">(cl)</span>

<span class="hl std">chain1</span> <span class="hl kwb">=</span> <span class="hl std">chains[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">chainOutput</span>
<span class="hl std">chain2</span> <span class="hl kwb">=</span> <span class="hl std">chains[[</span><span class="hl num">2</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">chainOutput</span>
<span class="hl std">chain3</span> <span class="hl kwb">=</span> <span class="hl std">chains[[</span><span class="hl num">3</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">chainOutput</span>


<span class="hl std">plotChains</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">c1</span><span class="hl std">,</span> <span class="hl kwc">c2</span><span class="hl std">,</span> <span class="hl kwc">c3</span><span class="hl std">,</span> <span class="hl kwc">main</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl std">idx</span> <span class="hl kwb">=</span> <span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(c1)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(c1)</span>
    <span class="hl std">mcl</span> <span class="hl kwb">=</span> <span class="hl kwd">mcmc.list</span><span class="hl std">(</span><span class="hl kwd">as.mcmc</span><span class="hl std">(c1),</span>
                    <span class="hl kwd">as.mcmc</span><span class="hl std">(c2),</span>
                    <span class="hl kwd">as.mcmc</span><span class="hl std">(c3))</span>
    <span class="hl std">g.d</span> <span class="hl kwb">=</span> <span class="hl kwd">gelman.diag</span><span class="hl std">(mcl)</span>
    <span class="hl std">main</span> <span class="hl kwb">=</span> <span class="hl kwd">paste</span><span class="hl std">(main,</span> <span class="hl str">&quot;\n&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Gelman Convergence Diagnostic and UL: \n&quot;</span><span class="hl std">,</span>
                 <span class="hl kwd">round</span><span class="hl std">(g.d[[</span><span class="hl num">1</span><span class="hl std">]][</span><span class="hl num">1</span><span class="hl std">],</span><span class="hl num">2</span><span class="hl std">),</span> <span class="hl str">&quot;, &quot;</span><span class="hl std">,</span> <span class="hl kwd">round</span><span class="hl std">(g.d[[</span><span class="hl num">1</span><span class="hl std">]][</span><span class="hl num">2</span><span class="hl std">],</span><span class="hl num">2</span><span class="hl std">))</span>

    <span class="hl kwd">plot</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">Iteration[idx], c1[idx],</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span> <span class="hl std">= main,</span>
         <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Iteration&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;value&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">rgb</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0.5</span><span class="hl std">))</span>
    <span class="hl kwd">points</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">Iteration[idx], c1[idx],</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">0.5</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span><span class="hl kwd">rgb</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0.5</span><span class="hl std">))</span>

    <span class="hl kwd">lines</span><span class="hl std">(chain2</span><span class="hl opt">$</span><span class="hl std">Iteration[idx],c2[idx],</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">rgb</span><span class="hl std">(</span><span class="hl num">0.5</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0.2</span><span class="hl std">,</span><span class="hl num">0.5</span><span class="hl std">),</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
    <span class="hl kwd">points</span><span class="hl std">(chain2</span><span class="hl opt">$</span><span class="hl std">Iteration[idx], c2[idx],</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">0.5</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span><span class="hl kwd">rgb</span><span class="hl std">(</span><span class="hl num">0.5</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0.2</span><span class="hl std">,</span><span class="hl num">0.5</span><span class="hl std">))</span>

    <span class="hl kwd">lines</span><span class="hl std">(chain3</span><span class="hl opt">$</span><span class="hl std">Iteration[idx],c3[idx],</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">rgb</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">0.5</span><span class="hl std">),</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
    <span class="hl kwd">points</span><span class="hl std">(chain3</span><span class="hl opt">$</span><span class="hl std">Iteration[idx], c3[idx],</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">0.5</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span><span class="hl kwd">rgb</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0.5</span><span class="hl std">))</span>
<span class="hl std">}</span>


<span class="hl std">figure8</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">))</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_0,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_0,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_0,</span>
             <span class="hl str">&quot;Guinea Exposure Intercept&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_1,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_1,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_1,</span>
             <span class="hl str">&quot;Liberia Exposure Intercept&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(chain1</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_2,</span>
             <span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_2,</span>
             <span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">BetaP_SE_2,</span>
             <span class="hl str">&quot;Sierra Leone Exposure Intercept&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>

<span class="hl std">figure8_5</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl kwd">any</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(Z))){</span><span class="hl kwd">return</span><span class="hl std">()}</span>
  <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl kwd">ncol</span><span class="hl std">(X)</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">ncol</span><span class="hl std">(X)</span> <span class="hl opt">+</span> <span class="hl kwd">ncol</span><span class="hl std">(Z)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">))</span>
  <span class="hl std">{</span>
      <span class="hl kwd">plotChains</span><span class="hl std">(chain1[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;BetaP_SE_&quot;</span><span class="hl std">, i,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
                 <span class="hl std">chain2[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;BetaP_SE_&quot;</span><span class="hl std">, i,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
                 <span class="hl std">chain3[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;BetaP_SE_&quot;</span><span class="hl std">, i,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
                 <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Temporal Basis Parameter &quot;</span><span class="hl std">, i</span><span class="hl opt">-</span><span class="hl kwd">ncol</span><span class="hl std">(X)</span><span class="hl opt">+</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">))</span>
  <span class="hl std">}</span>
<span class="hl std">}</span>

<span class="hl std">figure9</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">))</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain1</span><span class="hl opt">$</span><span class="hl std">gamma_ei),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">gamma_ei),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">gamma_ei)</span>
             <span class="hl std">,</span> <span class="hl str">&quot;E to I Transition Probability&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">plotChains</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain1</span><span class="hl opt">$</span><span class="hl std">gamma_ir),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain2</span><span class="hl opt">$</span><span class="hl std">gamma_ir),</span>
             <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">chain3</span><span class="hl opt">$</span><span class="hl std">gamma_ir)</span>
             <span class="hl std">,</span> <span class="hl str">&quot;I to R Transition Probability&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>

<span class="hl std">figure9_5</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>
  <span class="hl com">#par(mfrow = c(length(dmList), 1))</span>
  <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(dmList))</span>
  <span class="hl std">{</span>
      <span class="hl kwd">plotChains</span><span class="hl std">(chain1[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;rho_&quot;</span><span class="hl std">, i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
                 <span class="hl std">chain2[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;rho_&quot;</span><span class="hl std">, i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
                 <span class="hl std">chain3[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;rho_&quot;</span><span class="hl std">, i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
                 <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Spatial Parameter &quot;</span><span class="hl std">, i,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)</span>
                 <span class="hl std">)</span>
  <span class="hl std">}</span>
<span class="hl std">}</span>

<span class="hl com">## Parameter Estimates </span>

<span class="hl std">nbeta</span> <span class="hl kwb">=</span> <span class="hl kwd">ncol</span><span class="hl std">(X)</span> <span class="hl opt">+</span> <span class="hl kwd">ifelse</span><span class="hl std">(</span><span class="hl kwd">class</span><span class="hl std">(Z)</span> <span class="hl opt">==</span> <span class="hl str">&quot;matrix&quot;</span><span class="hl std">,</span> <span class="hl kwd">ncol</span><span class="hl std">(Z),</span> <span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">c1</span> <span class="hl kwb">=</span> <span class="hl std">chain1[</span><span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(chain1)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(chain1),</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(nbeta</span> <span class="hl opt">+</span> <span class="hl kwd">length</span><span class="hl std">(dmList)),</span>
                                                 <span class="hl std">(nbeta</span><span class="hl opt">+</span><span class="hl kwd">length</span><span class="hl std">(dmList)</span><span class="hl opt">+</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">:</span>
                                                   <span class="hl std">(nbeta</span><span class="hl opt">+</span><span class="hl kwd">length</span><span class="hl std">(dmList)</span><span class="hl opt">+</span><span class="hl num">3</span><span class="hl std">))]</span>
<span class="hl std">c2</span> <span class="hl kwb">=</span> <span class="hl std">chain2[</span><span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(chain2)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(chain2),</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(nbeta</span> <span class="hl opt">+</span> <span class="hl kwd">length</span><span class="hl std">(dmList)),</span>
                                                 <span class="hl std">(nbeta</span><span class="hl opt">+</span><span class="hl kwd">length</span><span class="hl std">(dmList)</span><span class="hl opt">+</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">:</span>
                                                   <span class="hl std">(nbeta</span><span class="hl opt">+</span><span class="hl kwd">length</span><span class="hl std">(dmList)</span><span class="hl opt">+</span><span class="hl num">3</span><span class="hl std">))]</span>
<span class="hl std">c3</span> <span class="hl kwb">=</span> <span class="hl std">chain3[</span><span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(chain3)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(chain3),</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(nbeta</span> <span class="hl opt">+</span> <span class="hl kwd">length</span><span class="hl std">(dmList)),</span>
                                                 <span class="hl std">(nbeta</span><span class="hl opt">+</span><span class="hl kwd">length</span><span class="hl std">(dmList)</span><span class="hl opt">+</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">:</span>
                                                   <span class="hl std">(nbeta</span><span class="hl opt">+</span><span class="hl kwd">length</span><span class="hl std">(dmList)</span><span class="hl opt">+</span><span class="hl num">3</span><span class="hl std">))]</span>

<span class="hl std">c1</span><span class="hl opt">$</span><span class="hl std">gamma_ei</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c1</span><span class="hl opt">$</span><span class="hl std">gamma_ei)</span>
<span class="hl std">c1</span><span class="hl opt">$</span><span class="hl std">gamma_ir</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c1</span><span class="hl opt">$</span><span class="hl std">gamma_ir)</span>
<span class="hl std">c2</span><span class="hl opt">$</span><span class="hl std">gamma_ei</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c2</span><span class="hl opt">$</span><span class="hl std">gamma_ei)</span>
<span class="hl std">c2</span><span class="hl opt">$</span><span class="hl std">gamma_ir</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c2</span><span class="hl opt">$</span><span class="hl std">gamma_ir)</span>
<span class="hl std">c3</span><span class="hl opt">$</span><span class="hl std">gamma_ei</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c3</span><span class="hl opt">$</span><span class="hl std">gamma_ei)</span>
<span class="hl std">c3</span><span class="hl opt">$</span><span class="hl std">gamma_ir</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">c3</span><span class="hl opt">$</span><span class="hl std">gamma_ir)</span>
<span class="hl std">{</span>
<span class="hl kwa">if</span> <span class="hl std">(modelDF</span> <span class="hl opt">!=</span> <span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">{</span>
  <span class="hl kwd">colnames</span><span class="hl std">(c1)</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Guinea Intercept&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Liberia Intercept&quot;</span><span class="hl std">,</span>
                   <span class="hl str">&quot;Sierra Leone Intercept&quot;</span><span class="hl std">,</span>
                   <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Time component &quot;</span><span class="hl std">, (</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(nbeta</span><span class="hl opt">-</span><span class="hl kwd">ncol</span><span class="hl std">(X))),</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">),</span>
                   <span class="hl str">&quot;Overdispersion Precision&quot;</span><span class="hl std">,</span>
                   <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Spatial Dependence Parameter&quot;</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(dmList)),</span>
                   <span class="hl str">&quot;E to I probability&quot;</span><span class="hl std">,</span>
                   <span class="hl str">&quot;I to R probability&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>
<span class="hl kwa">else</span>
<span class="hl std">{</span>
      <span class="hl kwd">colnames</span><span class="hl std">(c1)</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Guinea Intercept&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Liberia Intercept&quot;</span><span class="hl std">,</span>
                   <span class="hl str">&quot;Sierra Leone Intercept&quot;</span><span class="hl std">,</span>
                   <span class="hl str">&quot;Overdispersion Precision&quot;</span><span class="hl std">,</span>
                   <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Spatial Dependence Parameter&quot;</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(dmList)),</span>
                   <span class="hl str">&quot;E to I probability&quot;</span><span class="hl std">,</span>
                   <span class="hl str">&quot;I to R probability&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>
<span class="hl std">}</span>
<span class="hl kwd">colnames</span><span class="hl std">(c2)</span> <span class="hl kwb">=</span> <span class="hl kwd">colnames</span><span class="hl std">(c1)</span>
<span class="hl kwd">colnames</span><span class="hl std">(c3)</span> <span class="hl kwb">=</span> <span class="hl kwd">colnames</span><span class="hl std">(c1)</span>

<span class="hl std">mcl</span> <span class="hl kwb">=</span> <span class="hl kwd">mcmc.list</span><span class="hl std">(</span><span class="hl kwd">as.mcmc</span><span class="hl std">(c1),</span>
                <span class="hl kwd">as.mcmc</span><span class="hl std">(c2),</span>
                <span class="hl kwd">as.mcmc</span><span class="hl std">(c3))</span>
<span class="hl kwd">summary</span><span class="hl std">(mcl)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## Iterations = 1:1611
## Thinning interval = 1 
## Number of chains = 3 
## Sample size per chain = 1611 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##                                   Mean      SD Naive SE Time-series SE
## Guinea Intercept               -2.6183 0.21500 3.09e-03       1.27e-02
## Liberia Intercept              -1.7022 0.22419 3.22e-03       1.32e-02
## Sierra Leone Intercept         -1.5345 0.22406 3.22e-03       1.32e-02
## Time component 1               -0.1536 0.22401 3.22e-03       1.23e-02
## Time component 2               -0.3824 0.23419 3.37e-03       1.40e-02
## Time component 3               -0.4788 0.16325 2.35e-03       8.61e-03
## Time component 4               -0.6064 0.47392 6.82e-03       2.69e-02
## Time component 5               -1.4167 0.13486 1.94e-03       5.26e-03
## Overdispersion Precision        0.0879 0.00541 7.78e-05       1.21e-04
## Spatial Dependence Parameter 1  6.6680 0.06645 9.56e-04       9.45e-04
## E to I probability              0.1677 0.00151 2.17e-05       9.71e-05
## I to R probability              0.1294 0.00122 1.75e-05       4.92e-05
## 
## 2. Quantiles for each variable:
## 
##                                   2.5%     25%    50%      75%   97.5%
## Guinea Intercept               -3.0529 -2.7581 -2.614 -2.47036 -2.2159
## Liberia Intercept              -2.1527 -1.8491 -1.702 -1.55241 -1.2687
## Sierra Leone Intercept         -1.9862 -1.6806 -1.530 -1.38447 -1.1031
## Time component 1               -0.5946 -0.3033 -0.159 -0.00768  0.2932
## Time component 2               -0.8356 -0.5402 -0.383 -0.22859  0.0846
## Time component 3               -0.8011 -0.5852 -0.484 -0.36894 -0.1511
## Time component 4               -1.5162 -0.9279 -0.616 -0.29990  0.3589
## Time component 5               -1.6792 -1.5048 -1.417 -1.32358 -1.1570
## Overdispersion Precision        0.0769  0.0843  0.088  0.09157  0.0983
## Spatial Dependence Parameter 1  6.5409  6.6227  6.668  6.71354  6.7949
## E to I probability              0.1647  0.1666  0.168  0.16870  0.1706
## I to R probability              0.1271  0.1286  0.129  0.13025  0.1318
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">## R0 stuff</span>

<span class="hl std">R0_list</span> <span class="hl kwb">=</span> <span class="hl std">chains[[</span><span class="hl num">2</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">R0</span>




<span class="hl std">figure10</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">R0_list</span><span class="hl std">,</span> <span class="hl kwc">type</span><span class="hl std">)</span>
<span class="hl std">{</span>
  <span class="hl std">r0.ylim</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">min</span><span class="hl std">(R0_list</span><span class="hl opt">$</span><span class="hl std">LB),</span> <span class="hl kwd">max</span><span class="hl std">(R0_list</span><span class="hl opt">$</span><span class="hl std">UB))</span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">))</span>
  <span class="hl std">plotR0</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">main</span><span class="hl std">,</span> <span class="hl kwc">idx</span><span class="hl std">)</span>
  <span class="hl std">{</span>
    <span class="hl kwd">plot</span><span class="hl std">(rptDate[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)], R0_list</span><span class="hl opt">$</span><span class="hl std">mean[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">),idx] ,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span>
         <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl kwd">expression</span><span class="hl std">(</span><span class="hl str">'R'</span><span class="hl std">[</span><span class="hl num">0</span><span class="hl std">]),</span>
         <span class="hl kwc">main</span> <span class="hl std">= main,</span>
         <span class="hl kwc">ylim</span> <span class="hl std">= r0.ylim,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
    <span class="hl kwd">lines</span><span class="hl std">(rptDate[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)], R0_list</span><span class="hl opt">$</span><span class="hl std">LB[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">),idx],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
    <span class="hl kwd">lines</span><span class="hl std">(rptDate[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)], R0_list</span><span class="hl opt">$</span><span class="hl std">UB[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(rptDate)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">),idx],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
    <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span><span class="hl std">=</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">50</span><span class="hl std">,</span> <span class="hl num">0.5</span><span class="hl std">),</span> <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span><span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl num">1.0</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1.5</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl std">}</span>
  <span class="hl kwd">plotR0</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Guinea &quot;</span><span class="hl std">,type,</span> <span class="hl str">&quot;R0&quot;</span><span class="hl std">,</span><span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">),</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">plotR0</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Liberia &quot;</span><span class="hl std">, type,</span> <span class="hl str">&quot;R0&quot;</span><span class="hl std">,</span><span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">),</span><span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">plotR0</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Sierra Leone &quot;</span><span class="hl std">, type,</span><span class="hl str">&quot;R0&quot;</span><span class="hl std">,</span><span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std">),</span> <span class="hl num">3</span><span class="hl std">)</span>
<span class="hl std">}</span>

<span class="hl com"># Guinea, Liberia, Sierra Leone</span>

<span class="hl std">getMeanAndCI</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">loc</span><span class="hl std">,</span><span class="hl kwc">tpt</span><span class="hl std">,</span><span class="hl kwc">baseStr</span><span class="hl std">=</span><span class="hl str">&quot;I_&quot;</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl std">vec</span> <span class="hl kwb">=</span> <span class="hl std">chain1[[</span><span class="hl kwd">paste</span><span class="hl std">(baseStr, loc,</span> <span class="hl str">&quot;_&quot;</span><span class="hl std">, tpt,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]]</span>
    <span class="hl std">vec</span> <span class="hl kwb">=</span> <span class="hl std">vec[</span><span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(vec)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">)</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(vec)]</span>
    <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">mean</span><span class="hl std">(vec),</span> <span class="hl kwd">quantile</span><span class="hl std">(vec,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">,</span> <span class="hl num">0.95</span><span class="hl std">))))</span>
<span class="hl std">}</span>

<span class="hl std">Guinea.I.Est</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star)</span><span class="hl opt">-</span> <span class="hl num">1</span><span class="hl std">), getMeanAndCI,</span> <span class="hl kwc">loc</span><span class="hl std">=</span><span class="hl num">0</span><span class="hl std">)</span>
<span class="hl std">Liberia.I.Est</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star)</span><span class="hl opt">-</span> <span class="hl num">1</span><span class="hl std">), getMeanAndCI,</span> <span class="hl kwc">loc</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">)</span>
<span class="hl std">SierraLeone.I.Est</span> <span class="hl kwb">=</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(I_star)</span><span class="hl opt">-</span> <span class="hl num">1</span><span class="hl std">), getMeanAndCI,</span> <span class="hl kwc">loc</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">)</span>

<span class="hl com"># Declare prediction functions</span>
<span class="hl std">predictEpidemic</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">beta.pred</span><span class="hl std">,</span>
                           <span class="hl kwc">X.pred</span><span class="hl std">,</span>
                           <span class="hl kwc">gamma.ei</span><span class="hl std">,</span>
                           <span class="hl kwc">gamma.ir</span><span class="hl std">,</span>
                           <span class="hl kwc">S0</span><span class="hl std">,</span>
                           <span class="hl kwc">E0</span><span class="hl std">,</span>
                           <span class="hl kwc">I0</span><span class="hl std">,</span>
                           <span class="hl kwc">R0</span><span class="hl std">,</span>
                           <span class="hl kwc">rho</span><span class="hl std">,</span>
                           <span class="hl kwc">offsets.pred</span><span class="hl std">)</span>
<span class="hl std">{</span>
    <span class="hl std">N</span> <span class="hl kwb">=</span> <span class="hl std">(S0</span><span class="hl opt">+</span><span class="hl std">E0</span><span class="hl opt">+</span><span class="hl std">I0</span><span class="hl opt">+</span><span class="hl std">R0)</span>
    <span class="hl std">offsets.pred</span><span class="hl kwb">=</span><span class="hl kwd">c</span><span class="hl std">(offsets.pred,</span><span class="hl num">1</span><span class="hl std">)</span>
    <span class="hl std">p_se_components</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl kwd">exp</span><span class="hl std">(X.pred</span> <span class="hl opt">%*%</span> <span class="hl std">beta.pred),</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0))</span>
    <span class="hl std">p_se</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl kwd">length</span><span class="hl std">(S0),</span> <span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
    <span class="hl std">p_ei</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">gamma.ei</span><span class="hl opt">*</span><span class="hl std">offsets.pred)</span>
    <span class="hl std">p_ir</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">gamma.ir</span><span class="hl opt">*</span><span class="hl std">offsets.pred)</span>
    <span class="hl std">S_star</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
    <span class="hl std">E_star</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
    <span class="hl std">I_star</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
    <span class="hl std">R_star</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
    <span class="hl std">S</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
    <span class="hl std">E</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
    <span class="hl std">I</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
    <span class="hl std">R</span> <span class="hl kwb">=</span> <span class="hl kwd">matrix</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">ncol</span><span class="hl std">=</span><span class="hl kwd">length</span><span class="hl std">(S0),</span><span class="hl kwc">nrow</span> <span class="hl std">=</span> <span class="hl kwd">nrow</span><span class="hl std">(p_se_components))</span>
    <span class="hl std">S[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl std">S0</span>
    <span class="hl std">E[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl std">E0</span>
    <span class="hl std">I[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl std">I0</span>
    <span class="hl std">R[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl std">R0</span>
    <span class="hl std">S_star[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), R0,</span> <span class="hl num">0</span><span class="hl std">)</span>
    <span class="hl std">p_se[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl std">I[</span><span class="hl num">1</span><span class="hl std">,]</span><span class="hl opt">/</span><span class="hl std">N</span><span class="hl opt">*</span><span class="hl std">p_se_components[</span><span class="hl num">1</span><span class="hl std">,]</span>
    <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(dmList))</span>
    <span class="hl std">{</span>
      <span class="hl std">p_se[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl std">p_se[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl std">rho[i]</span><span class="hl opt">*</span><span class="hl std">(dmList[[i]]</span> <span class="hl opt">%*%</span> <span class="hl std">(I[</span><span class="hl num">1</span><span class="hl std">,]</span><span class="hl opt">/</span><span class="hl std">N</span><span class="hl opt">*</span><span class="hl std">p_se_components[</span><span class="hl num">1</span><span class="hl std">,]))</span>
    <span class="hl std">}</span>
    <span class="hl std">p_se[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">offsets.pred[</span><span class="hl num">1</span><span class="hl std">]</span><span class="hl opt">*</span><span class="hl std">(p_se[</span><span class="hl num">1</span><span class="hl std">,]))</span>

    <span class="hl std">E_star[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), S0, p_se[</span><span class="hl num">1</span><span class="hl std">,])</span>
    <span class="hl std">I_star[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), E0, p_ei[</span><span class="hl num">1</span><span class="hl std">])</span>
    <span class="hl std">R_star[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), I0, p_ir[</span><span class="hl num">1</span><span class="hl std">])</span>

    <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">nrow</span><span class="hl std">(S))</span>
    <span class="hl std">{</span>

      <span class="hl std">S[i,]</span> <span class="hl kwb">=</span> <span class="hl std">S[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl std">S_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">-</span> <span class="hl std">E_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span>
      <span class="hl std">E[i,]</span> <span class="hl kwb">=</span> <span class="hl std">E[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl std">E_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">-</span> <span class="hl std">I_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span>
      <span class="hl std">I[i,]</span> <span class="hl kwb">=</span> <span class="hl std">I[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl std">I_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">-</span> <span class="hl std">R_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span>
      <span class="hl std">R[i,]</span> <span class="hl kwb">=</span> <span class="hl std">R[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl std">R_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">-</span> <span class="hl std">S_star[i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,]</span>

      <span class="hl std">p_se[i,]</span> <span class="hl kwb">=</span> <span class="hl std">I[i,]</span><span class="hl opt">/</span><span class="hl std">N</span><span class="hl opt">*</span><span class="hl std">p_se_components[i,]</span>
      <span class="hl kwa">for</span> <span class="hl std">(j</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(dmList))</span>
      <span class="hl std">{</span>
        <span class="hl std">p_se[i,]</span> <span class="hl kwb">=</span> <span class="hl std">p_se[i,]</span> <span class="hl opt">+</span> <span class="hl std">rho[j]</span><span class="hl opt">*</span><span class="hl std">(dmList[[j]]</span> <span class="hl opt">%*%</span> <span class="hl std">(I[i,]</span><span class="hl opt">/</span><span class="hl std">N</span><span class="hl opt">*</span><span class="hl std">p_se_components[i,]))</span>
      <span class="hl std">}</span>
      <span class="hl std">p_se[i,]</span> <span class="hl kwb">=</span> <span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">exp</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl std">offsets.pred[i]</span><span class="hl opt">*</span><span class="hl std">(p_se[i,]))</span>


      <span class="hl std">S_star[i,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), R[i,],</span> <span class="hl num">0</span><span class="hl std">)</span>
      <span class="hl std">E_star[i,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), S[i,], p_se[i,])</span>
      <span class="hl std">I_star[i,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), E[i,], p_ei[i])</span>
      <span class="hl std">R_star[i,]</span> <span class="hl kwb">=</span> <span class="hl kwd">rbinom</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(S0)), I[i,], p_ir[i])</span>
    <span class="hl std">}</span>
    <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">S</span><span class="hl std">=S,</span><span class="hl kwc">E</span><span class="hl std">=E,</span><span class="hl kwc">I</span><span class="hl std">=I,</span><span class="hl kwc">R</span><span class="hl std">=R,</span>
                <span class="hl kwc">S_star</span><span class="hl std">=S_star,</span><span class="hl kwc">E_star</span><span class="hl std">=E_star,</span>
                <span class="hl kwc">I_star</span><span class="hl std">=I_star,</span><span class="hl kwc">R_star</span><span class="hl std">=R_star,</span>
                <span class="hl kwc">p_se</span><span class="hl std">=p_se,</span><span class="hl kwc">p_ei</span><span class="hl std">=p_ei,</span><span class="hl kwc">p_ir</span><span class="hl std">=p_ir))</span>
<span class="hl std">}</span>


<span class="hl std">predict.i</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">i</span><span class="hl std">)</span>
<span class="hl std">{</span>
  <span class="hl std">dataRow</span> <span class="hl kwb">=</span> <span class="hl std">chain1[i,]</span>
  <span class="hl std">rho</span> <span class="hl kwb">=</span> <span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(dmList))</span>
  <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(dmList))</span>
  <span class="hl std">{</span>
    <span class="hl std">rho[i]</span> <span class="hl kwb">=</span> <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;rho_&quot;</span><span class="hl std">, i</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]]</span>
  <span class="hl std">}</span>
  <span class="hl std">beta</span> <span class="hl kwb">=</span> <span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, modelDF</span><span class="hl opt">+</span><span class="hl kwd">ncol</span><span class="hl std">(X))</span>
  <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">0</span><span class="hl opt">:</span><span class="hl std">(modelDF</span><span class="hl opt">+</span><span class="hl kwd">ncol</span><span class="hl std">(X)</span> <span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">))</span>
  <span class="hl std">{</span>
    <span class="hl std">beta[i</span><span class="hl opt">+</span><span class="hl num">1</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;BetaP_SE_&quot;</span><span class="hl std">, i,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]]</span>
  <span class="hl std">}</span>

  <span class="hl std">S0</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;S_0_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;S_1_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;S_2_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;S_3_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]])</span>
  <span class="hl std">E0</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;E_0_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;E_1_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;E_2_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;E_3_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]])</span>
  <span class="hl std">I0</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;I_0_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;I_1_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;I_2_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;I_3_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]])</span>
  <span class="hl std">R0</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;R_0_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;R_1_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;R_2_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]],</span>
         <span class="hl std">dataRow[[</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;R_3_&quot;</span><span class="hl std">, maxIdx</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)]])</span>


  <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">predictEpidemic</span><span class="hl std">(beta,</span>
                         <span class="hl std">X.pred,</span>
                         <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">gamma_ei,</span>
                         <span class="hl std">dataRow</span><span class="hl opt">$</span><span class="hl std">gamma_ir,</span>
                         <span class="hl std">S0,</span>
                         <span class="hl std">E0,</span>
                         <span class="hl std">I0,</span>
                         <span class="hl std">R0,</span>
                         <span class="hl std">rho,</span>
                         <span class="hl std">offset.pred</span>
                         <span class="hl std">))</span>
<span class="hl std">}</span>

<span class="hl std">preds</span> <span class="hl kwb">=</span> <span class="hl kwd">lapply</span><span class="hl std">((</span><span class="hl kwd">nrow</span><span class="hl std">(chain1)</span> <span class="hl opt">-</span> <span class="hl kwd">floor</span><span class="hl std">(</span><span class="hl kwd">nrow</span><span class="hl std">(chain1)</span><span class="hl opt">/</span><span class="hl num">2</span><span class="hl std">))</span><span class="hl opt">:</span>
                  <span class="hl kwd">nrow</span><span class="hl std">(chain1), predict.i)</span>


<span class="hl std">pred.dates</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(rptDate[(</span><span class="hl kwd">which.max</span><span class="hl std">(rptDate))],</span>
               <span class="hl std">rptDate[(</span><span class="hl kwd">which.max</span><span class="hl std">(rptDate))]</span> <span class="hl opt">+</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,pred.days</span><span class="hl opt">-</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">))</span>
<span class="hl std">pred.xlim</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">min</span><span class="hl std">(rptDate),</span> <span class="hl kwd">max</span><span class="hl std">(pred.dates))</span>
<span class="hl std">lastIdx</span> <span class="hl kwb">=</span> <span class="hl kwd">nrow</span><span class="hl std">(I_star)</span>
<span class="hl std">Guinea.Pred</span> <span class="hl kwb">=</span> <span class="hl std">preds[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">1</span><span class="hl std">]</span>
<span class="hl std">Liberia.Pred</span> <span class="hl kwb">=</span> <span class="hl std">preds[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">2</span><span class="hl std">]</span>
<span class="hl std">SierraLeone.Pred</span> <span class="hl kwb">=</span> <span class="hl std">preds[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">3</span><span class="hl std">]</span>

<span class="hl std">breakpoint</span> <span class="hl kwb">=</span> <span class="hl kwd">mean</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">max</span><span class="hl std">(rptDate),</span> <span class="hl kwd">min</span><span class="hl std">(pred.dates)))</span>

<span class="hl kwa">for</span> <span class="hl std">(predIdx</span> <span class="hl kwa">in</span> <span class="hl num">2</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(preds))</span>
<span class="hl std">{</span>
   <span class="hl std">Guinea.Pred</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(Guinea.Pred, preds[[predIdx]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">1</span><span class="hl std">])</span>
   <span class="hl std">Liberia.Pred</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(Liberia.Pred, preds[[predIdx]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">2</span><span class="hl std">])</span>
   <span class="hl std">SierraLeone.Pred</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(SierraLeone.Pred, preds[[predIdx]]</span><span class="hl opt">$</span><span class="hl std">I[,</span><span class="hl num">3</span><span class="hl std">])</span>
<span class="hl std">}</span>

<span class="hl std">Guinea.mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Guinea.Pred,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>
<span class="hl std">Liberia.mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Liberia.Pred,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>
<span class="hl std">SierraLeone.mean</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(SierraLeone.Pred,</span> <span class="hl num">2</span><span class="hl std">, mean)</span>


<span class="hl std">Guinea.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Guinea.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
<span class="hl std">Guinea.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Guinea.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

<span class="hl std">Liberia.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Liberia.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
<span class="hl std">Liberia.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(Liberia.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

<span class="hl std">SierraLeone.LB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(SierraLeone.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.05</span><span class="hl std">))</span>
<span class="hl std">SierraLeone.UB</span> <span class="hl kwb">=</span> <span class="hl kwd">apply</span><span class="hl std">(SierraLeone.Pred,</span> <span class="hl num">2</span><span class="hl std">, quantile,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.95</span><span class="hl std">))</span>

<span class="hl std">maxI</span> <span class="hl kwb">=</span> <span class="hl kwd">max</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">max</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(Guinea.I.Est, Liberia.I.Est, SierraLeone.I.Est)), Guinea.UB, Liberia.UB, SierraLeone.UB))</span>

<span class="hl std">est.idx</span> <span class="hl kwb">=</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwd">length</span><span class="hl std">(Guinea.I.Est[</span><span class="hl num">1</span><span class="hl std">,]),</span> <span class="hl num">2</span><span class="hl std">)</span>
<span class="hl std">pred.table1</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(Guinea.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span>
                    <span class="hl std">Liberia.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span>
                    <span class="hl std">SierraLeone.I.Est[</span><span class="hl num">1</span><span class="hl std">,]</span>
                    <span class="hl std">)[est.idx,]</span>
<span class="hl std">pred.table2</span> <span class="hl kwb">=</span> <span class="hl kwd">cbind</span><span class="hl std">(Guinea.mean,</span>
                    <span class="hl std">Liberia.mean,</span>
                    <span class="hl std">SierraLeone.mean)</span>
<span class="hl std">pred.table</span> <span class="hl kwb">=</span> <span class="hl kwd">rbind</span><span class="hl std">(pred.table1, pred.table2)</span>
<span class="hl kwd">rownames</span><span class="hl std">(pred.table)</span> <span class="hl kwb">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;&quot;</span><span class="hl std">,</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">as.character</span><span class="hl std">(rptDate)[est.idx],</span> <span class="hl kwd">as.character</span><span class="hl std">(pred.dates)),</span>
                                          <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)</span>
<span class="hl kwd">rownames</span><span class="hl std">(pred.table)</span> <span class="hl kwb">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl kwd">rownames</span><span class="hl std">(pred.table),</span> <span class="hl str">&quot;&amp;nbsp;&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)</span>
<span class="hl kwd">colnames</span><span class="hl std">(pred.table)</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Guinea&quot;</span><span class="hl std">,</span>
                         <span class="hl str">&quot;Liberia&quot;</span><span class="hl std">,</span>
                         <span class="hl str">&quot;Sierra Leone&quot;</span><span class="hl std">)</span>


<span class="hl std">figure11</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>

  <span class="hl com">## Guinea </span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">))</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span> <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Guinea Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">1000000</span><span class="hl std">,</span><span class="hl num">5000</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.mean,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.LB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.UB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>

  <span class="hl com">## Liberia </span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span>  <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Liberia Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">1000000</span><span class="hl std">,</span><span class="hl num">5000</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.mean,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.LB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.UB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>

  <span class="hl com">## Sierra Leone</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">, maxI),</span>  <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Sierra Leone Estimated Epidemic Size\n 90% Credible Interval&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span><span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">1000000</span><span class="hl std">,</span><span class="hl num">5000</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">1</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">2</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">3</span><span class="hl std">,],</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span><span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.mean,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.LB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.UB,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>

<span class="hl std">}</span>


<span class="hl std">figure11_5</span> <span class="hl kwb">=</span> <span class="hl kwa">function</span><span class="hl std">()</span>
<span class="hl std">{</span>

  <span class="hl com">## Guinea </span>
  <span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">))</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">, maxI),</span> <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Guinea Estimated Epidemic Size\n 90% Credible Interval (log scale)&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span> <span class="hl kwc">log</span> <span class="hl std">=</span><span class="hl str">&quot;y&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl opt">^</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">100</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">2</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Guinea.I.Est[</span><span class="hl num">3</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.mean</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.LB</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Guinea.UB</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;black&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>

  <span class="hl com">## Liberia </span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">, maxI),</span>  <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Liberia Estimated Epidemic Size\n 90% Credible Interval (log scale)&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span> <span class="hl kwc">log</span> <span class="hl std">=</span><span class="hl str">&quot;y&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl opt">^</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">100</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">2</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, Liberia.I.Est[</span><span class="hl num">3</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.mean</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.LB</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,Liberia.UB</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;blue&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>

  <span class="hl com">## Sierra Leone</span>
  <span class="hl kwd">plot</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">, maxI),</span>  <span class="hl kwc">xlim</span> <span class="hl std">= pred.xlim,</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Sierra Leone Estimated Epidemic Size\n 90% Credible Interval (log scale)&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span><span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Infectious Count&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Date&quot;</span><span class="hl std">,</span> <span class="hl kwc">log</span> <span class="hl std">=</span><span class="hl str">&quot;y&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl opt">^</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">100</span><span class="hl std">),</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">1</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">2</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(rptDate, SierraLeone.I.Est[</span><span class="hl num">3</span><span class="hl std">,]</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span><span class="hl str">&quot;red&quot;</span><span class="hl std">)</span>

  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.mean</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.LB</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">lines</span><span class="hl std">(pred.dates,SierraLeone.UB</span> <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl std">,</span>
          <span class="hl kwc">lty</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
  <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">v</span> <span class="hl std">= breakpoint,</span> <span class="hl kwc">lty</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">col</span><span class="hl std">=</span> <span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">)</span>

<span class="hl std">}</span>
</pre></div>
</div></div>
</div>
<br/>
<br/>
<h3><a id="analysis-2-convergence-sect" class="anchor">Convergence</a></h3>
<p>As this is a Bayesian analysis in which the posterior distribution is sampled using MCMC techniques, we really need some
indication that the samplers have indeed converged to the posterior distribution in order to make any inferences about the 
problem at hand. In the code below, we'll read in the MCMC output files created so far, plot the three chains for each of 
several important parameters, and take a look at the Gelman and Rubin convergence diagnostic (which should be close to 1 if the chains have converged.)
</p>
<div class="chunk" id="PlotFigure8"><div class="rimage center"><img src="figure/PlotFigure8.png" title="plot of chunk PlotFigure8" alt="plot of chunk PlotFigure8" class="plot" /></div></div>

<div class="chunk" id="PlotFigure8_5"><div class="rimage center"><img src="figure/PlotFigure8_51.png" title="plot of chunk PlotFigure8_5" alt="plot of chunk PlotFigure8_5" class="plot" /></div><div class="rimage center"><img src="figure/PlotFigure8_52.png" title="plot of chunk PlotFigure8_5" alt="plot of chunk PlotFigure8_5" class="plot" /></div><div class="rimage center"><img src="figure/PlotFigure8_53.png" title="plot of chunk PlotFigure8_5" alt="plot of chunk PlotFigure8_5" class="plot" /></div><div class="rimage center"><img src="figure/PlotFigure8_54.png" title="plot of chunk PlotFigure8_5" alt="plot of chunk PlotFigure8_5" class="plot" /></div><div class="rimage center"><img src="figure/PlotFigure8_55.png" title="plot of chunk PlotFigure8_5" alt="plot of chunk PlotFigure8_5" class="plot" /></div></div>

<div class="chunk" id="PlotFigure9"><div class="rimage center"><img src="figure/PlotFigure9.png" title="plot of chunk PlotFigure9" alt="plot of chunk PlotFigure9" class="plot" /></div></div>

<div class="chunk" id="PlotFigure9_5"><div class="rimage center"><img src="figure/PlotFigure9_5.png" title="plot of chunk PlotFigure9_5" alt="plot of chunk PlotFigure9_5" class="plot" /></div></div>

<br/>


<a id="analysis-2-r0-sect" class="anchor"><h3>Basic Reproductive Number Calculation</h3></a>


<p>
A common tool for describing the evolution of an epidemic is a quantity known as the basic reproductive numer, the basic reproductive ratio, or one of several other variants on that theme. The basic idea is to quantify how many secondary infections a single infectious individual is expected to cause in a large, fully susceptible population. Naturally, when this ratio exceeds one we expect the epidemic to spread. Conversely, a basic reproductive number less than one indicates that a pathogen is more likely to die out.</p>

<p>
In truth, there is a lot more to "basic reproductive number" calculation, especially given that different authors use different names for the same quantity, and vice versa. Here we present three different versions. First, we introduce a fairly standard
"time varying basic reproductive number". This quantity is based on the intensity process parameter estimates over time, and is described in Lekone and Finkenstadt (2006). Also described in this work is the "effective" reproductive rate, which is the same quantity scaled by the number of susceptibles (almost the same in this case, due to the relatively small infectious fraction). Finally, we introduce our own, tentatively titled "empirical reproductive number". This measure follows actual transmission probabilities through time and looks at the number of secondary 
cases produced, on average, by one of the infectious individuals in a particular location at a particular time point. While still influenced by
the parametric form chosen, this alternative approach to basic reproductive number calculation may more closely reflect population dynamics. 
</p>
<br/><br/>

<hr></div><div class="rimage center"><img src="figure/PlotR0Stuff1.png" title="plot of chunk PlotR0Stuff" alt="plot of chunk PlotR0Stuff" class="plot" /></div><div class="rcode">
<hr></div><div class="rimage center"><img src="figure/PlotR0Stuff2.png" title="plot of chunk PlotR0Stuff" alt="plot of chunk PlotR0Stuff" class="plot" /></div><div class="rcode">
</div><div class="rimage center"><img src="figure/PlotR0Stuff3.png" title="plot of chunk PlotR0Stuff" alt="plot of chunk PlotR0Stuff" class="plot" /></div><div class="rcode">



While the basic reproductive number is a useful quantity to know, it does not directly make any predictions about future epidemic behavior. In order to do that, we need to simulate epidemics  based on the MCMC samples we have obtained and summarize their variability over time. <br/>


<a id="analysis-2-prediction-sect" class="anchor"><h3>Epidemic Prediction</h3></a><br/>

<br/><br/><p> 
Below, we will attempt to predict the course of the epidemic through early fall. 

We must be cautious when making predictions about a chaotic process this far into the future. The intensity function which drives the exposure process is based on simple smooth functions of time, rather than any external information. While this is perfectly adequate for estimation, it may or may not provide good prediction performance. 
</p>

<div class="chunk" id="Plotfigure11"><div class="rimage center"><img src="figure/Plotfigure11.png" title="plot of chunk Plotfigure11" alt="plot of chunk Plotfigure11" class="plot" /></div></div>

It is sometimes helpful to visualize exponential growth on the log scale. 

<div class="chunk" id="PlotFigure11_5"><div class="rimage center"><img src="figure/PlotFigure11_5.png" title="plot of chunk PlotFigure11_5" alt="plot of chunk PlotFigure11_5" class="plot" /></div></div>


<br/>
<p>It can also be helpful to take a look at the data in tabular form.</p><br/>


<div class="row">
<div class="col-sm-2"></div>
<div class="col-sm-9">
<h4>Estimated and Predicted number of Infectious Individuals</h4><br/>
<table>
 <thead>
  <tr>
   <th align="left">   </th>
   <th align="center"> Guinea </th>
   <th align="center"> Liberia </th>
   <th align="center"> Sierra Leone </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td align="left"> 2014-03-24&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-03-31&nbsp; </td>
   <td align="center"> 26 </td>
   <td align="center"> 3 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-07&nbsp; </td>
   <td align="center"> 42 </td>
   <td align="center"> 6 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-14&nbsp; </td>
   <td align="center"> 32 </td>
   <td align="center"> 1 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-20&nbsp; </td>
   <td align="center"> 49 </td>
   <td align="center"> 1 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-04-24&nbsp; </td>
   <td align="center"> 32 </td>
   <td align="center"> 1 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-05&nbsp; </td>
   <td align="center"> 31 </td>
   <td align="center"> 1 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-05-23&nbsp; </td>
   <td align="center"> 35 </td>
   <td align="center"> 1 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-01&nbsp; </td>
   <td align="center"> 31 </td>
   <td align="center"> 2 </td>
   <td align="center"> 39 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-10&nbsp; </td>
   <td align="center"> 40 </td>
   <td align="center"> 1 </td>
   <td align="center"> 34 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-17&nbsp; </td>
   <td align="center"> 19 </td>
   <td align="center"> 14 </td>
   <td align="center"> 21 </td>
  </tr>
  <tr>
   <td align="left"> 2014-06-30&nbsp; </td>
   <td align="center"> 8 </td>
   <td align="center"> 25 </td>
   <td align="center"> 53 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-12&nbsp; </td>
   <td align="center"> 8 </td>
   <td align="center"> 61 </td>
   <td align="center"> 115 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-20&nbsp; </td>
   <td align="center"> 9 </td>
   <td align="center"> 91 </td>
   <td align="center"> 98 </td>
  </tr>
  <tr>
   <td align="left"> 2014-07-27&nbsp; </td>
   <td align="center"> 45 </td>
   <td align="center"> 148 </td>
   <td align="center"> 90 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-04&nbsp; </td>
   <td align="center"> 40 </td>
   <td align="center"> 202 </td>
   <td align="center"> 126 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-11&nbsp; </td>
   <td align="center"> 35 </td>
   <td align="center"> 268 </td>
   <td align="center"> 139 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-18&nbsp; </td>
   <td align="center"> 79 </td>
   <td align="center"> 360 </td>
   <td align="center"> 158 </td>
  </tr>
  <tr>
   <td align="left"> 2014-08-31&nbsp; </td>
   <td align="center"> 189 </td>
   <td align="center"> 717 </td>
   <td align="center"> 331 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-09&nbsp; </td>
   <td align="center"> 113 </td>
   <td align="center"> 475 </td>
   <td align="center"> 260 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-17&nbsp; </td>
   <td align="center"> 102 </td>
   <td align="center"> 630 </td>
   <td align="center"> 337 </td>
  </tr>
  <tr>
   <td align="left"> 2014-09-21&nbsp; </td>
   <td align="center"> 94 </td>
   <td align="center"> 448 </td>
   <td align="center"> 291 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-01&nbsp; </td>
   <td align="center"> 177 </td>
   <td align="center"> 666 </td>
   <td align="center"> 581 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-07&nbsp; </td>
   <td align="center"> 174 </td>
   <td align="center"> 453 </td>
   <td align="center"> 617 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-12&nbsp; </td>
   <td align="center"> 212 </td>
   <td align="center"> 570 </td>
   <td align="center"> 662 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-21&nbsp; </td>
   <td align="center"> 146 </td>
   <td align="center"> 717 </td>
   <td align="center"> 716 </td>
  </tr>
  <tr>
   <td align="left"> 2014-10-29&nbsp; </td>
   <td align="center"> 176 </td>
   <td align="center"> 2042 </td>
   <td align="center"> 1223 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-08&nbsp; </td>
   <td align="center"> 155 </td>
   <td align="center"> 550 </td>
   <td align="center"> 517 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-15&nbsp; </td>
   <td align="center"> 167 </td>
   <td align="center"> 496 </td>
   <td align="center"> 753 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-22&nbsp; </td>
   <td align="center"> 220 </td>
   <td align="center"> 365 </td>
   <td align="center"> 1017 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-22&nbsp; </td>
   <td align="center"> 220 </td>
   <td align="center"> 365 </td>
   <td align="center"> 1017 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-24&nbsp; </td>
   <td align="center"> 212 </td>
   <td align="center"> 349 </td>
   <td align="center"> 982 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-26&nbsp; </td>
   <td align="center"> 195 </td>
   <td align="center"> 320 </td>
   <td align="center"> 911 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-28&nbsp; </td>
   <td align="center"> 178 </td>
   <td align="center"> 293 </td>
   <td align="center"> 845 </td>
  </tr>
  <tr>
   <td align="left"> 2014-11-30&nbsp; </td>
   <td align="center"> 162 </td>
   <td align="center"> 268 </td>
   <td align="center"> 782 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-02&nbsp; </td>
   <td align="center"> 147 </td>
   <td align="center"> 245 </td>
   <td align="center"> 721 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-04&nbsp; </td>
   <td align="center"> 133 </td>
   <td align="center"> 223 </td>
   <td align="center"> 663 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-06&nbsp; </td>
   <td align="center"> 120 </td>
   <td align="center"> 203 </td>
   <td align="center"> 608 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-08&nbsp; </td>
   <td align="center"> 107 </td>
   <td align="center"> 183 </td>
   <td align="center"> 555 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-10&nbsp; </td>
   <td align="center"> 96 </td>
   <td align="center"> 166 </td>
   <td align="center"> 505 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-12&nbsp; </td>
   <td align="center"> 86 </td>
   <td align="center"> 149 </td>
   <td align="center"> 458 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-14&nbsp; </td>
   <td align="center"> 77 </td>
   <td align="center"> 134 </td>
   <td align="center"> 414 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-16&nbsp; </td>
   <td align="center"> 68 </td>
   <td align="center"> 120 </td>
   <td align="center"> 373 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-18&nbsp; </td>
   <td align="center"> 60 </td>
   <td align="center"> 107 </td>
   <td align="center"> 335 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-20&nbsp; </td>
   <td align="center"> 53 </td>
   <td align="center"> 95 </td>
   <td align="center"> 300 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-22&nbsp; </td>
   <td align="center"> 47 </td>
   <td align="center"> 84 </td>
   <td align="center"> 268 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-24&nbsp; </td>
   <td align="center"> 41 </td>
   <td align="center"> 74 </td>
   <td align="center"> 238 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-26&nbsp; </td>
   <td align="center"> 36 </td>
   <td align="center"> 66 </td>
   <td align="center"> 211 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-28&nbsp; </td>
   <td align="center"> 32 </td>
   <td align="center"> 57 </td>
   <td align="center"> 187 </td>
  </tr>
  <tr>
   <td align="left"> 2014-12-30&nbsp; </td>
   <td align="center"> 28 </td>
   <td align="center"> 50 </td>
   <td align="center"> 165 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-01&nbsp; </td>
   <td align="center"> 24 </td>
   <td align="center"> 44 </td>
   <td align="center"> 145 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-03&nbsp; </td>
   <td align="center"> 21 </td>
   <td align="center"> 38 </td>
   <td align="center"> 127 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-05&nbsp; </td>
   <td align="center"> 18 </td>
   <td align="center"> 33 </td>
   <td align="center"> 111 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-07&nbsp; </td>
   <td align="center"> 16 </td>
   <td align="center"> 29 </td>
   <td align="center"> 97 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-09&nbsp; </td>
   <td align="center"> 14 </td>
   <td align="center"> 25 </td>
   <td align="center"> 84 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-11&nbsp; </td>
   <td align="center"> 12 </td>
   <td align="center"> 22 </td>
   <td align="center"> 73 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-13&nbsp; </td>
   <td align="center"> 10 </td>
   <td align="center"> 19 </td>
   <td align="center"> 63 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-15&nbsp; </td>
   <td align="center"> 9 </td>
   <td align="center"> 16 </td>
   <td align="center"> 54 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-17&nbsp; </td>
   <td align="center"> 8 </td>
   <td align="center"> 14 </td>
   <td align="center"> 47 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-19&nbsp; </td>
   <td align="center"> 6 </td>
   <td align="center"> 12 </td>
   <td align="center"> 40 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-21&nbsp; </td>
   <td align="center"> 5 </td>
   <td align="center"> 10 </td>
   <td align="center"> 34 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-23&nbsp; </td>
   <td align="center"> 5 </td>
   <td align="center"> 8 </td>
   <td align="center"> 30 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-25&nbsp; </td>
   <td align="center"> 4 </td>
   <td align="center"> 7 </td>
   <td align="center"> 25 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-27&nbsp; </td>
   <td align="center"> 3 </td>
   <td align="center"> 6 </td>
   <td align="center"> 21 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-29&nbsp; </td>
   <td align="center"> 3 </td>
   <td align="center"> 5 </td>
   <td align="center"> 18 </td>
  </tr>
  <tr>
   <td align="left"> 2015-01-31&nbsp; </td>
   <td align="center"> 2 </td>
   <td align="center"> 4 </td>
   <td align="center"> 15 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-02&nbsp; </td>
   <td align="center"> 2 </td>
   <td align="center"> 4 </td>
   <td align="center"> 13 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-04&nbsp; </td>
   <td align="center"> 2 </td>
   <td align="center"> 3 </td>
   <td align="center"> 11 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-06&nbsp; </td>
   <td align="center"> 1 </td>
   <td align="center"> 3 </td>
   <td align="center"> 9 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-08&nbsp; </td>
   <td align="center"> 1 </td>
   <td align="center"> 2 </td>
   <td align="center"> 8 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-10&nbsp; </td>
   <td align="center"> 1 </td>
   <td align="center"> 2 </td>
   <td align="center"> 7 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-12&nbsp; </td>
   <td align="center"> 1 </td>
   <td align="center"> 1 </td>
   <td align="center"> 5 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-14&nbsp; </td>
   <td align="center"> 1 </td>
   <td align="center"> 1 </td>
   <td align="center"> 5 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-16&nbsp; </td>
   <td align="center"> 1 </td>
   <td align="center"> 1 </td>
   <td align="center"> 4 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-18&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
   <td align="center"> 3 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-20&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
   <td align="center"> 3 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-22&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
   <td align="center"> 2 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-24&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 2 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-26&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
  </tr>
  <tr>
   <td align="left"> 2015-02-28&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
  </tr>
  <tr>
   <td align="left"> 2015-03-02&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
  </tr>
  <tr>
   <td align="left"> 2015-03-04&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
  </tr>
  <tr>
   <td align="left"> 2015-03-06&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
  </tr>
  <tr>
   <td align="left"> 2015-03-08&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 1 </td>
  </tr>
  <tr>
   <td align="left"> 2015-03-10&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2015-03-12&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2015-03-14&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2015-03-16&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2015-03-18&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
  </tr>
  <tr>
   <td align="left"> 2015-03-20&nbsp; </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
   <td align="center"> 0 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Such data can also be visualized in map form, though the recent surge in predicted cases has the effect of swamping the earlier dynamics:</p>
<br/>
<h4 align=center>Total Infection Size - Estimated and Predicted:</h4>
<div class='container' id ="pred_app" style="position: relative; max-width: 100%; height:100%">
  <div class = "row" ng-controller='rChartsCtrl_pred' >
    <div class="col-sm-3">
      <input id='zoom-map-slider-pred' type='range' min=1 max=
366
      ng-model='pred_Day' width=200>
       <span>Day: <span id ="zoom-map-day-counter-pred"></span></span>
    </div>
    <div class="col-sm-1">  <button class="btn btn-mini btn-primary" id="zoom-map-play-pred" type="button">Play</button></div>
    <div class = "col-sm-6"></div>
  </div>
  <div class="row">
    <div id='zoom_map_pred' class='rChart datamaps col-sm-8 col-sm-offset-1' style="position: relative; max-width: 100%; height:100%"></div>  
    <div class="col-sm-3"></div>
  </div>
</div>
<br/>
<br/>
<br/>


<a id = "conclusions-sect" class="anchor"><h3>Conclusions</h3></a>
<br/>
<p>
This epidemic is evolving extremely rapidly. As of 8/12, it looked like the situation in Liberia was set to continue worsening, and that Guinea is at risk of the same (though not to nearly the same degree). On the other hand, the epidemic in Sierra Leone appeared to be leveling off (though not disappearing). As of 8/28, these look like reasonable predictions, however the models appear to have resumed predicting a fairly catastrophic continued spread, especially in liberia. In particular, the models predict that the epidemic will take off in Nigeria, as the countries are assumed in this case to share several intensity parameters. We may hope that this particular simplifying assumption is invalid, however it is not a hopeful sign that WHO predictions are also becoming catastrophic. These models can not anticipate public health interventions and sudden changes in governmental policy and individual behavior, but recent news from the region gives little reason to hope for a swift end to the epidemic. It is more important now than ever to support the efforts of involved governmental and non-governmental organizations like the <a href="http://www.who.int/en/">WHO</a> and <a href="http://www.doctorswithoutborders.org/about-us">MSF</a></p><br/>

<p>
That wraps up the analyses for now. This document will continue to be updated as the epidemic progresses, reflecting new data and perhaps additional analysis techniques. As the document is tracked via source control it will be easy to see how well past predictions held up and how they change in response to new information. Questions and comments can be shared <a href="https://github.com/grantbrown/libspatialSEIR/issues/1">here</a> 
</p><br/>
      
      </div>
    <div class="col-sm-1">
    </div>
  </div>
</div>
    <a id="dummy_anchor" class = "anchor"></a>  
    <script src="./js/jquery.min.js"></script>
    <script src="./bootstrap/js/bootstrap.min.js"></script>
    <script src="./js/d3.v3.min.js"></script>
    <script src="./js/topojson.v1.min.js"></script>
    <script src='./js/handlebars.min.js' type='text/javascript'></script>
    <script src="./js/angular.min.js"></script>
    <script src="./js/datamaps.world.min.js"></script>
    
    <script>
  function rChartsCtrl($scope){
    $scope.Day = 1;
    $scope.$watch('Day', function(newDay){
      zoom.updateChoropleth(alldata[newDay]);
      $("#zoom-map-day-counter").text(dayLabels[newDay]);
    })
  }
    </script>
    <script>
  function rChartsCtrl_pred($scope){
    console.log("PredCalled.");
    $scope.pred_Day = 1;
    $scope.$watch('pred_Day', function(newDay){
      zoom_pred.updateChoropleth(alldata_pred[newDay]);
      $("#zoom-map-day-counter-pred").text(dayLabels[newDay]);
    })
  }
</script>    

<script id='popup-template' type='text/x-handlebars-template'>
</script>

<script>
var alldata = 
<div class="error"><pre class="knitr r">## Error: could not find function "toJSON2"
</pre></div>



var chartParams={"dom": "zoom_map",
"scope": "world",
"legend":true,
"geographyConfig":{
  "borderColor":"#cccccc",
  "borderWidth":"2px"},
"fills": 
<div class="error"><pre class="knitr r">## Error: could not find function "toJSON2"
</pre></div>

,
"data":
<div class="error"><pre class="knitr r">## Error: could not find function "toJSON2"
</pre></div>

,"setProjection": function( element, options ) {
    var path;
    var projection = d3.geo.equirectangular()
        .center([1, 13])
        .rotate([4.4, 0])
    	  .scale(700)
  		  .translate([element.offsetWidth / 2, element.offsetHeight / 2]);
     
    path = d3.geo.path()
      .projection( projection );
 
    return {path: path, projection: projection};
  }
}

chartParams.element = document.getElementById('zoom_map')
  
  
  var zoom = new Datamap(chartParams);
  
  if (chartParams.labels){
    zoom.labels()
  }
  
  if (chartParams.legend){
    zoom.legend()
  }


</script>
<script type="text/javascript">
var playing_pred=false;

function intervalFunction_pred(slider,counter,sliderVal){
    if (eval(slider.val()) >= eval(slider.attr("max")))
    {
      slider.val(1);
      counter.text(dayLabels[1]);
      zoom_pred.updateChoropleth(alldata_pred[1]);
      playing_pred = false;
      clearInterval(intervalVariable_pred);
      $("#zoom-map-play-pred").text("Play");
    }
    else if (!playing_pred)
    {
      clearInterval(intervalVariable_pred);
      $("#zoom-map-play-pred").text("Play");
    }
    else
    {
      sliderVal = eval(slider.val()) + 1;
      slider.val(sliderVal);
      counter.text(dayLabels[sliderVal]);
      zoom_pred.updateChoropleth(alldata_pred[sliderVal]);
    }
}



$("#zoom-map-play-pred").click(function(){
    var slider = $("#zoom-map-slider-pred");
    var counter = $("#zoom-map-day-counter-pred");
    var sliderVal = 0;
    if (playing_pred)
    {
      playing_pred = false;
    }
    else
    {
      playing_pred = true;
      $("#zoom-map-play-pred").text("Pause");
      intervalVariable_pred = setInterval(function(){intervalFunction_pred(slider,counter,sliderVal)},100);
    }
});
</script>

<script type="text/javascript">
var playing=false;

function intervalFunction(slider,counter,sliderVal){
    if (eval(slider.val()) >= eval(slider.attr("max")))
    {
      console.log("Exit Case 1.");
      slider.val(1);
      counter.text(dayLabels[1]);
      zoom.updateChoropleth(alldata[1]);
      playing = false;
      clearInterval(intervalVariable);
      $("#zoom-map-play").text("Play");
    }
    else if (!playing)
    {
      console.log("Exit Case 2.");
      clearInterval(intervalVariable);
      $("#zoom-map-play").text("Play");
    }
    else
    {
      sliderVal = eval(slider.val()) + 1;
      console.log("Run Case: " + sliderVal);
      slider.val(sliderVal);
      counter.text(dayLabels[sliderVal]);
      zoom.updateChoropleth(alldata[sliderVal]);
    }
}



$("#zoom-map-play").click(function(){
    var slider = $("#zoom-map-slider");
    var counter = $("#zoom-map-day-counter");
    var sliderVal = 0;
    if (playing)
    {
      playing = false;
    }
    else
    {
      playing = true;
      $("#zoom-map-play").text("Pause");
      intervalVariable = setInterval(function(){intervalFunction(slider,counter,sliderVal)},100);
    }
});
</script>


<script>
var alldata_pred = 
<div class="error"><pre class="knitr r">## Error: could not find function "toJSON2"
</pre></div>



var dayLabels=
<div class="error"><pre class="knitr r">## Error: could not find function "toJSON2"
</pre></div>
;
var chartParams_pred={"dom": "zoom_map_pred",
"scope": "world",
"legend":true,
"geographyConfig":{
  "borderColor":"#cccccc",
  "borderWidth":"2px"},
"fills": 
<div class="error"><pre class="knitr r">## Error: could not find function "toJSON2"
</pre></div>

,
"data":
<div class="error"><pre class="knitr r">## Error: could not find function "toJSON2"
</pre></div>

,"setProjection": function( element, options ) {
    var path;
    var projection = d3.geo.equirectangular()
        .center([1, 13])
        .rotate([4.4, 0])
    	  .scale(700)
  		  .translate([element.offsetWidth / 2, element.offsetHeight / 2]);
     
    path = d3.geo.path()
      .projection( projection );
 
    return {path: path, projection: projection};
  }
}

chartParams_pred.element = document.getElementById('zoom_map_pred')

var zoom_pred = new Datamap(chartParams_pred);

if (chartParams_pred.labels){
  zoom_pred.labels()
}

if (chartParams_pred.legend){
  zoom_pred.legend()
}
</script>
<script type="text/javascript">
  var data_app = angular.module('data_app', []);
  var pred_app = angular.module('pred_app', []);
  angular.bootstrap(document.getElementById("pred_app"), ['data_app']);
</script>

<script type="text/javascript">
      $(document).ready(function(){
        $("table").addClass("table-striped");
        $("table").addClass("table-bordered");
      });

      $(".code-button").click(function(){
          $(this).next().animate({
            opacity: 1,
            left: "+=100",
            height: "toggle"
          }, 100, function() {
          });
      });
      
    </script>
  
  </body>
</html>
